<!-- START OF FILE ai_studio_code (Bugfix_Reset_System).html -->
<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <title>OBSERVATION DUTY: CLEAN RESET</title>
    <style>
        :root {
            --bg-color: #050505;
            --ui-bg: #111;
            --text: #33ff33;
            --alert: #ff3333;
        }
        body { margin: 0; background: #000; height: 100vh; font-family: 'Courier New', monospace; overflow: hidden; user-select: none; display: flex; }

        /* --- –ú–û–ù–ò–¢–û–† --- */
        #monitor-frame {
            flex: 3; background: #080808; padding: 25px;
            display: flex; flex-direction: column; position: relative;
        }
        #screen {
            flex-grow: 1; background: #050505; position: relative;
            border: 2px solid #333; overflow: hidden;
            box-shadow: 0 0 20px rgba(0,0,0,0.8);
            cursor: crosshair;
        }
        
        /* –≠–§–§–ï–ö–¢–´ */
        #cam-layer { position: absolute; inset: 0; pointer-events: none; z-index: 100; }
        #vignette { position: absolute; inset: 0; background: radial-gradient(circle, transparent 55%, rgba(0,0,0,0.5) 90%, black 100%); z-index: 101; }
        #scanlines { position: absolute; inset: 0; background: linear-gradient(rgba(0,0,0,0) 50%, rgba(0,0,0,0.1) 50%); background-size: 100% 4px; z-index: 102; pointer-events: none; opacity: 0.3; }
        
        #static { 
            position: absolute; inset: 0; opacity: 0.04; 
            background-image: url('data:image/svg+xml,<svg xmlns="http://www.w3.org/2000/svg" width="200" height="200"><filter id="n"><feTurbulence type="fractalNoise" baseFrequency="0.8"/></filter><rect width="100%" height="100%" filter="url(%23n)"/></svg>'); 
            z-index: 103; pointer-events: none; mix-blend-mode: overlay; 
            transition: opacity 0.1s;
        }
        .static-active {
            opacity: 0.8 !important;
            filter: contrast(200%) brightness(150%);
            mix-blend-mode: normal !important;
            background-color: #111;
        }

        #glitch-layer { position: absolute; inset: 0; display: none; background: rgba(255,255,255,0.1); z-index: 104; pointer-events: none; mix-blend-mode: overlay;}

        /* –ò–ù–§–û */
        #cam-info { position: absolute; top: 30px; left: 30px; color: #ddd; font-size: 28px; z-index: 110; font-weight: bold; text-shadow: 1px 1px 2px black; letter-spacing: 2px; }
        #rec-dot { position: absolute; top: 35px; right: 200px; width: 12px; height: 12px; background: #ff0000; border-radius: 50%; z-index: 110; animation: blink 2s infinite; box-shadow: 0 0 5px red; }
        #time-display { position: absolute; bottom: 30px; right: 30px; color: #ccc; font-size: 20px; z-index: 110; font-weight: bold; }
        #level-indicator { position: absolute; top: 30px; right: 30px; color: var(--text); font-size: 24px; font-weight: bold; z-index: 110; text-shadow: 0 0 10px var(--text); border: 1px solid var(--text); padding: 5px 10px; background: rgba(0,50,0,0.5); }

        /* --- –ü–£–õ–¨–¢ --- */
        #control-panel { flex: 1; background: var(--ui-bg); border-left: 1px solid #222; display: flex; flex-direction: column; padding: 15px; gap: 10px; }
        #status-display { font-size: 14px; color: #666; text-align: center; border: 1px solid #222; padding: 8px; background: #000; margin-bottom: 10px; text-transform: uppercase; letter-spacing: 1px; }
        #cam-grid { display: grid; grid-template-columns: 1fr 1fr; gap: 8px; flex-grow: 1; max-height: 60vh; overflow-y: auto; }
        .cam-btn { background: #0a0a0a; color: #555; border: 1px solid #222; cursor: pointer; font-weight: bold; transition: 0.1s; font-size: 12px; display: flex; flex-direction: column; justify-content: center; align-items: center; padding: 8px 0; }
        .cam-btn span { font-size: 9px; margin-top: 4px; color: #444; text-transform: uppercase; }
        .cam-btn:hover { color: #888; background: #1a1a1a; }
        .cam-btn.active { color: #000; background: var(--text); border-color: var(--text); box-shadow: 0 0 10px var(--text); }
        .cam-btn.active span { color: #004400; font-weight: bold; }
        .action-btn { padding: 15px; font-size: 14px; font-weight: bold; cursor: pointer; border: none; text-transform: uppercase; }
        #report-btn { background: #300; color: #faa; border: 1px solid #800; } #report-btn:hover { background: #600; color: white; }
        #clean-btn { background: #002200; color: #afa; border: 1px solid #060; margin-top: 5px;} #clean-btn:hover { background: #004400; color: white; }
        #guide-btn { background: #222; color: #ccc; border: 1px solid #444; margin-top: auto; } #guide-btn:hover { background: #444; }

        /* --- –ú–ï–ù–Æ –†–ï–ü–û–†–¢–ê --- */
        #report-overlay { position: absolute; inset: 0; background: rgba(0,0,0,0.95); z-index: 200; display: none; flex-direction: column; justify-content: center; align-items: center; }
        .rep-group { display: grid; grid-template-columns: 1fr 1fr; gap: 10px; width: 80%; }
        .rep-type { padding: 15px; background: #111; border: 1px solid #333; color: #ccc; cursor: pointer; text-align: center; font-size: 14px; transition: 0.2s; text-transform: uppercase; }
        .rep-type:hover { background: #500; color: white; border-color: red; }

        /* --- –°–ü–†–ê–í–û–ß–ù–ò–ö --- */
        #guide-overlay { position: absolute; inset: 0; background: #0a0a0a; z-index: 300; display: none; flex-direction: column; padding: 40px; overflow-y: auto; }
        .guide-title { color: var(--text); font-size: 24px; text-align: center; margin-bottom: 30px; border-bottom: 2px solid #333; padding-bottom: 10px; text-transform: uppercase;}
        .guide-grid { display: grid; grid-template-columns: 1fr 1fr; gap: 20px; max-width: 900px; margin: 0 auto; }
        .guide-item { border: 1px solid #333; padding: 15px; background: #111; }
        .guide-item h4 { color: #fff; margin: 0 0 10px 0; text-transform: uppercase; border-bottom: 1px solid #222; padding-bottom: 5px; }
        .guide-item p { color: #888; font-size: 12px; margin: 0; line-height: 1.4; }
        .sound-btn { display: block; width: 100%; margin-top: 5px; padding: 8px; background: #222; color: #fa0; border: 1px solid #530; cursor: pointer; text-align: left; font-family: inherit; font-size: 11px; transition: 0.2s; }
        .sound-btn:hover { background: #fa0; color: #000; }
        .sound-grid { display: grid; grid-template-columns: 1fr 1fr; gap: 5px; margin-top: 10px; }
        .close-guide { margin: 30px auto 0; padding: 10px 40px; background: #300; color: white; border: none; cursor: pointer; font-size: 16px; text-transform: uppercase; }

        /* --- –ö–û–ú–ù–ê–¢–´ --- */
        .room-container {
            width: 100%; height: 100%; position: absolute; background: #111; display: none; overflow: hidden;
            /* –Ø–†–ö–û–°–¢–¨ –ü–û–í–´–®–ï–ù–ê */
            filter: brightness(0.95) sepia(0.2) contrast(1.1); 
            transform-style: preserve-3d;
        }
        .room-container.visible { display: block; }
        
        .wall { position: absolute; top: 0; left: 0; width: 100%; height: 75%; background: #444; z-index: 0; box-shadow: inset 0 0 80px rgba(0,0,0,0.7); }
        .floor { position: absolute; bottom: 0; left: 0; width: 100%; height: 25%; background: #222; z-index: 1; border-top: 1px solid #111; background-image: repeating-linear-gradient(90deg, transparent, transparent 19px, #1a1a1a 20px), repeating-linear-gradient(0deg, transparent, transparent 19px, #1a1a1a 20px); background-size: 20px 20px; }
        .wall-grunge { background-color: #3e3e3e; background-image: url("data:image/svg+xml,%3Csvg width='100' height='100' viewBox='0 0 100 100' xmlns='http://www.w3.org/2000/svg'%3E%3Cfilter id='noise'%3E%3CfeTurbulence type='fractalNoise' baseFrequency='0.8' numOctaves='3'/%3E%3C/filter%3E%3Crect width='100%25' height='100%25' filter='url(%23noise)' opacity='0.15'/%3E%3C/svg%3E"); }
        
        .obj { position: absolute; box-sizing: border-box; transition: transform 1s cubic-bezier(0.2, 0.8, 0.2, 1); z-index: 10; }
        
        /* SHAPES */
        .furniture, .shape-fridge, .shape-monstera-pot, .shape-stairs, .shape-barrel-blue, .shape-workbench, .shape-cabinet, .dummy-base, .shape-bookshelf, .shape-bed, .shape-sofa, .shape-long-stand, .shape-extinguisher { 
            box-shadow: 10px 10px 25px rgba(0,0,0,0.9);
        }

        /* --- –û–ö–ù–ê: –°–í–ï–¢–õ–ï–ï --- */
        .window { 
            background: #203045; /* –°–≤–µ—Ç–ª–µ–µ, —Å–∏–Ω–∏–π –æ—Ç—Ç–µ–Ω–æ–∫ */
            border: 4px solid #111; 
            overflow: hidden; 
            box-shadow: 0 0 15px rgba(100,150,255,0.1); 
        }
        /* –≠—Ñ—Ñ–µ–∫—Ç —Å—Ç–µ–∫–ª–∞/—Å–≤–µ—Ç–∞ */
        .window::after { content:''; position:absolute; top:0; left:0; width:100%; height:100%; background: linear-gradient(135deg, rgba(255,255,255,0.1) 0%, transparent 60%); pointer-events: none; z-index: 3;}
        /* –†–∞–º–∞ */
        .window-frame-v { content:''; top:0; left:50%; width:4px; height:100%; background:#111; position:absolute; z-index:2; }
        .window-frame-h { content:''; top:50%; left:0; width:100%; height:4px; background:#111; position:absolute; z-index:2; }

        .dummy-base { background: #111; border-radius: 10px 10px 5px 5px; }
        .dummy-pole { background: #222; border-left: 2px solid #000; border-right: 2px solid #000; }
        .dummy-torso { background: #dcb495; border-radius: 15px 15px 10px 10px; box-shadow: inset -5px 0 10px rgba(0,0,0,0.3); }
        .dummy-head { background: #dcb495; border-radius: 50%; box-shadow: inset -3px -3px 5px rgba(0,0,0,0.3); }

        .shape-fridge { background: #cfcfcf; border: 2px solid #999; border-radius: 2px; }
        .shape-fridge::before { content:''; position: absolute; top: 30%; left: 0; width: 100%; height: 2px; background: #888; box-shadow: 0 1px 2px rgba(0,0,0,0.3); }
        .fridge-handle-top { position: absolute; top: 15%; left: 85%; width: 4px; height: 10%; background: #aaa; border-left: 1px solid #777; border-radius: 2px; }
        .fridge-note { position: absolute; top: 10%; left: 20%; width: 15%; height: 10%; background: #ffeb3b; box-shadow: 1px 1px 2px rgba(0,0,0,0.5); transform: rotate(-5deg); }

        .shape-long-stand { background: #212121; border-top: 2px solid #424242; }
        .shape-rug-large { background: #3e2723; opacity: 0.8; transform: perspective(200px) rotateX(20deg); border: 4px solid #2e1c11; }
        .shape-tv-flat { background: #050505; border: 2px solid #333; }

        .shape-bed { background: #444; border-bottom: 5px solid #222; border-radius: 0 0 10px 10px; }
        .shape-bed::before { content:''; position:absolute; top:-10%; left:0; width:100%; height:20%; background:#2e1c11; border-radius: 15px 15px 5px 5px; } 
        .shape-pillow { background: #ccc; border-radius: 6px; box-shadow: 1px 1px 3px black; }
        
        .shape-clock { background: #fff; border-radius: 50%; border: 4px solid #333; }
        .shape-clock::before { content:''; position:absolute; top:50%; left:50%; width:2px; height:40%; background:black; transform: translate(-50%, -100%); }
        .shape-clock::after { content:''; position:absolute; top:50%; left:50%; width:2px; height:25%; background:black; transform: translate(-50%, -100%) rotate(90deg); }

        .shape-rubber-duck { background: #ffeb3b; border-radius: 0 0 10px 10px; }
        .shape-rubber-duck::before { content:''; position:absolute; top:-10px; left:0px; width:15px; height:15px; background: #ffeb3b; border-radius: 50%; }
        .shape-rubber-duck::after { content:''; position:absolute; top:-5px; left:-5px; width:8px; height:4px; background: orange; border-radius: 2px; }

        .shape-cup { background: #fff; border-radius: 0 0 4px 4px; box-shadow: 2px 2px 5px black; }
        .shape-cup::before { content:''; position:absolute; top:20%; right:-4px; width:4px; height:8px; border:2px solid #fff; border-radius: 50%; }

        .shape-monstera-pot { background: #5d4037; width: 100%; clip-path: polygon(10% 100%, 90% 100%, 100% 0, 0 0); } 
        .monstera-leaf { position: absolute; background: #1b5e20; border-radius: 50% 0 50% 0; box-shadow: 2px 2px 5px rgba(0,0,0,0.5); }

        .shape-sofa { background: #3e2723; border-radius: 10px 10px 5px 5px; border-bottom: 5px solid #222; }
        .shape-sofa::before { content:''; position:absolute; bottom:0; left:-10px; width:10px; height:60%; background:#4e342e; border-radius: 10px 0 0 0; }
        .shape-sofa::after { content:''; position:absolute; bottom:0; right:-10px; width:10px; height:60%; background:#4e342e; border-radius: 0 10px 0 0; }

        .shape-clight-small { background: radial-gradient(circle, #fff 20%, #ddd 100%); border-radius: 50%; box-shadow: 0 0 40px rgba(255,255,255,0.4); border: 1px solid #999; z-index: 50; }

        .shape-workbench { background: #3e2723; border-top: 4px solid #5d4037; box-shadow: 5px 10px 15px black; }
        .wb-leg { position: absolute; top: 100%; width: 10%; height: 80%; background: #2e1c11; }
        .shape-toolboard { background: #222; border: 2px solid #444; box-shadow: 2px 2px 5px black; }
        .tool-hammer { background: #8d6e63; width: 4px; height: 100%; position: relative; margin: 0 auto; }
        .tool-hammer::before { content:''; position:absolute; top:0; left:-6px; width:16px; height:8px; background: #777; border-radius: 2px; }
        .tool-wrench { background: #888; width: 4px; height: 100%; position: relative; margin: 0 auto; border-radius: 2px; }
        .tool-wrench::before { content:''; position:absolute; top:0; left:-3px; width:10px; height:6px; border: 2px solid #888; border-top: none; border-radius: 0 0 5px 5px; }

        .toilet-tank { position: absolute; top: 0; left: 0; width: 100%; height: 45%; background: #eee; border: 1px solid #ccc; border-radius: 2px; }
        .toilet-bowl { position: absolute; bottom: 0; right: 0; width: 120%; height: 55%; background: #eee; border: 1px solid #ccc; border-radius: 0 0 15px 25px; transform: skewX(-10deg); }

        .shape-cabinet { background: #b71c1c; border: 2px solid #7f0000; display: flex; flex-direction: column; gap: 2px; padding: 2px; }
        .cabinet-drawer { background: #c62828; width: 100%; height: 18%; border: 1px solid #800; position: relative; }
        .cabinet-drawer::after { content:''; position: absolute; top: 50%; left: 50%; width: 30%; height: 2px; background: silver; transform: translate(-50%, -50%); }

        .shape-tire-stack { background: #111; border-radius: 3px; border: 1px solid #333; }
        .shape-tire-stack::before { content:''; position: absolute; top: -100%; left: 0; width: 100%; height: 100%; background: #111; border: 1px solid #333; border-radius: 3px; }
        .shape-tire-stack::after { content:''; position: absolute; top: -200%; left: 0; width: 100%; height: 100%; background: #111; border: 1px solid #333; border-radius: 3px; }

        .shape-barrel-blue { background: linear-gradient(90deg, #0d47a1, #1976d2 50%, #0d47a1); border: 1px solid #002171; border-radius: 5px; box-shadow: 5px 5px 15px black; }
        .shape-barrel-blue::before { content:''; position: absolute; top: 25%; left: 0; width: 100%; height: 8%; background: rgba(0,0,0,0.3); border-top: 1px solid rgba(255,255,255,0.1); border-bottom: 1px solid rgba(0,0,0,0.5); }
        .shape-barrel-blue::after { content:''; position: absolute; top: 65%; left: 0; width: 100%; height: 8%; background: rgba(0,0,0,0.3); border-top: 1px solid rgba(255,255,255,0.1); border-bottom: 1px solid rgba(0,0,0,0.5); }

        .shape-extinguisher { background: #b71c1c; border-radius: 5px 5px 2px 2px; }
        .shape-extinguisher::before { content:''; position: absolute; top: -5px; left: 30%; width: 40%; height: 5px; background: #333; }
        .shape-extinguisher::after { content:''; position: absolute; top: -5px; left: 80%; width: 10px; height: 30px; background: #111; border-radius: 2px; transform: rotate(-10deg); }

        .shape-box { background: #8d6e63; border: 1px solid #5d4037; }
        .shape-box::before { content:''; position: absolute; top: 0; left: 0; width: 50%; height: 100%; border-right: 1px solid #5d4037; }

        .shape-rack-shelf { background: #5d4037; border-bottom: 3px solid #3e2723; }
        .shape-jar { background: rgba(255,255,255,0.2); border: 1px solid rgba(255,255,255,0.4); border-radius: 3px; }
        .shape-jar::before { content:''; position:absolute; top:5px; left:0; width:100%; height:60%; background: orange; opacity: 0.5; }

        .poster { background: #ccc; color: #111; border: 1px solid #000; display: flex; align-items: center; justify-content: center; font-family: sans-serif; font-weight: bold; font-size: 10px; text-transform: uppercase; box-shadow: 2px 2px 5px rgba(0,0,0,0.5); }
        .poster-paper { background: #fdfefe; box-shadow: 0 0 2px black; transform: rotate(2deg); padding: 2px; font-size: 8px; text-align: center; }
        .poster-dark { background: #222; color: #eee; border: 1px solid #555; }
        .poster-straight { background: #ffeb3b; color: #000; border: 2px solid #000; display: flex; align-items: center; justify-content: center; font-weight: bold; font-size: 12px; box-shadow: 0 0 5px black; }
        .vent-grill { background: #222; border: 2px solid #444; background-image: repeating-linear-gradient(0deg, transparent, transparent 4px, #111 5px); }

        /* --- SUBTLE ANOMALIES --- */
        .ghost-subtle { position: absolute; width: 40px; height: 120px; background: #000; border-radius: 50% 50% 0 0; filter: blur(15px); opacity: 0.15; pointer-events: none; z-index: 5; }
        .shadow-corner { position: absolute; width: 100px; height: 100px; background: radial-gradient(circle at 100% 100%, transparent 20%, black 90%); opacity: 0.8; z-index: 20; pointer-events: none; }
        .intruder-dark { width: 15px; height: 35px; background: #050505; position: absolute; top: 40%; left: 45%; box-shadow: 0 0 20px rgba(0,0,0,1); opacity: 0.9; }
        .scary-text { color: #800 !important; font-family: 'Times New Roman', serif !important; font-weight: bold; font-size: 10px !important; letter-spacing: 1px; }

        @keyframes blink { 0% { opacity: 0.5; } 50% { opacity: 1; } 100% { opacity: 0.5; } }

        #fullscreen-msg { position: fixed; inset: 0; background: black; z-index: 500; display: flex; flex-direction: column; justify-content: center; align-items: center; font-size: 20px; text-align: center; border: 10px solid #111; }
    </style>
</head>
<body>

    <!-- –°–ü–†–ê–í–û–ß–ù–ò–ö (GUIDE) -->
    <div id="guide-overlay">
        <div class="guide-title">–°–ü–†–ê–í–û–ß–ù–ò–ö –ü–û –ê–ù–û–ú–ê–õ–ò–Ø–ú</div>
        <div class="guide-grid">
            <div class="guide-item">
                <h4>–ü–†–ò–ó–†–ê–ö / –¢–ï–ù–¨</h4>
                <p>–¢—ë–º–Ω—ã–µ –ø–æ–ª—É–ø—Ä–æ–∑—Ä–∞—á–Ω—ã–µ —Å–∏–ª—É—ç—Ç—ã, —Ç–µ–Ω–∏ –≤ —É–≥–ª–∞—Ö.</p>
            </div>
            <div class="guide-item">
                <h4>–ü–ï–†–ï–ú–ï–©–ï–ù–ò–ï</h4>
                <p>–ü—Ä–µ–¥–º–µ—Ç –º–µ–Ω—è–µ—Ç —Å–≤–æ—ë –ø–æ–ª–æ–∂–µ–Ω–∏–µ –æ–¥–∏–Ω —Ä–∞–∑.</p>
            </div>
            <div class="guide-item">
                <h4>–õ–ò–®–ù–ò–ô –ü–†–ï–î–ú–ï–¢</h4>
                <p>–ü–æ—è–≤–ª–µ–Ω–∏–µ –Ω–æ–≤–æ–≥–æ –æ–±—ä–µ–∫—Ç–∞ (–∫–æ—Ä–æ–±–∫–∞, –∫—Ä—É–∂–∫–∞, –ø—è—Ç–Ω–æ).</p>
            </div>
            <div class="guide-item">
                <h4>–ò–°–ß–ï–ó–ù–û–í–ï–ù–ò–ï</h4>
                <p>–ü—Ä–æ–ø–∞–∂–∞ –ª—é–±–æ–≥–æ –ø—Ä–µ–¥–º–µ—Ç–∞.</p>
            </div>
            <div class="guide-item">
                <h4>–ò–°–ö–ê–ñ–ï–ù–ò–ï</h4>
                <p>–ò–∑–º–µ–Ω–µ–Ω–∏–µ —Ñ–æ—Ä–º—ã –∏–ª–∏ —Ü–≤–µ—Ç–∞ –ø—Ä–µ–¥–º–µ—Ç–∞.</p>
            </div>
            <div class="guide-item">
                <h4>–ù–ê–î–ü–ò–°–¨</h4>
                <p>–ò–∑–º–µ–Ω–µ–Ω–∏–µ —Ç–µ–∫—Å—Ç–∞ –Ω–∞ –ø–ª–∞–∫–∞—Ç–∞—Ö.</p>
            </div>
            <div class="guide-item">
                <h4>–°–ë–û–ô –ö–ê–ú–ï–†–´</h4>
                <p>–ü–æ–º–µ—Ö–∏, –∫—Ä–∞—Å–Ω—ã–π —Ñ–∏–ª—å—Ç—Ä, –∑–∞—Ç–µ–º–Ω–µ–Ω–∏–µ.</p>
            </div>
            <div class="guide-item">
                <h4>–í–¢–û–†–ñ–ï–ù–ò–ï</h4>
                <p>–°–∏–ª—É—ç—Ç —á–µ–ª–æ–≤–µ–∫–∞ –≤ –ø—Ä–æ–µ–º–∞—Ö.</p>
            </div>
            <div class="guide-item" style="grid-column: span 2; border-color: #740;">
                <h4 style="color: #c84;">–ê–£–î–ò–û-–ê–ù–û–ú–ê–õ–ò–Ø (–ü–†–û–°–õ–£–®–ê–¢–¨)</h4>
                <p>–ù–∞–∂–º–∏—Ç–µ –Ω–∞ –∫–Ω–æ–ø–∫—É, —á—Ç–æ–±—ã —É—Å–ª—ã—à–∞—Ç—å –ø—Ä–∏–º–µ—Ä –∑–≤—É–∫–∞:</p>
                <div class="sound-grid">
                    <button class="sound-btn" onclick="AudioSys.playScarySound('breathing')">üîä –î–´–•–ê–ù–ò–ï (–¢—è–∂–µ–ª—ã–π –≤–∑–¥–æ—Ö)</button>
                    <button class="sound-btn" onclick="AudioSys.playScarySound('thud')">üîä –°–¢–£–ö (–ì–ª—É—Ö–æ–π —É–¥–∞—Ä)</button>
                    <button class="sound-btn" onclick="AudioSys.playScarySound('whine')">üîä –ü–ò–°–ö (–≠–ª–µ–∫—Ç—Ä–æ–Ω–∏–∫–∞)</button>
                    <button class="sound-btn" onclick="AudioSys.playScarySound('whisper')">üîä –®–ï–ü–û–¢ (–®–∏–ø–µ–Ω–∏–µ)</button>
                </div>
            </div>
        </div>
        <button class="close-guide" onclick="toggleGuide()">–ó–ê–ö–†–´–¢–¨</button>
    </div>

    <div id="fullscreen-msg">
        <h1 style="color:#var(--text); font-size: 30px; letter-spacing: 5px; margin-bottom: 40px;">–°–ò–°–¢–ï–ú–ê –ù–ê–ë–õ–Æ–î–ï–ù–ò–Ø</h1>
        <div style="color:#888; max-width: 600px; line-height: 1.5; font-size: 16px;">
            <p>–ó–ê–î–ê–ß–ê: –ù–∞–π—Ç–∏ 20 –∞–Ω–æ–º–∞–ª–∏–π.</p>
            <br>
            <p style="color:#aaa">–ü–†–ò–ú–ï–ß–ê–ù–ò–ï:</p>
            <ul style="text-align: left; margin: 20px auto; max-width: 400px; color: #777;">
                <li>–ó–≤—É–∫ –∏–≥—Ä–∞–µ—Ç –ø—Ä–∏ –æ–±–Ω–∞—Ä—É–∂–µ–Ω–∏–∏ –∞–Ω–æ–º–∞–ª–∏–∏.</li>
                <li>–ì—Ä–æ–º–∫–æ—Å—Ç—å –æ—Ç–∫–∞–ª–∏–±—Ä–æ–≤–∞–Ω–∞.</li>
            </ul>
        </div>
        <button onclick="toggleGuide()" style="margin-top: 20px; padding: 10px 30px; background: #111; border: 1px solid #333; color: #888; cursor: pointer;">–°–ü–†–ê–í–û–ß–ù–ò–ö</button>
        <button onclick="initGame()" style="margin-top: 20px; padding: 15px 50px; background: #222; border: 1px solid #444; color: #ccc; font-family: inherit; font-size: 18px; cursor: pointer; text-transform: uppercase;">–ù–ê–ß–ê–¢–¨ –°–ú–ï–ù–£</button>
    </div>

    <div id="monitor-frame">
        <div id="screen">
            <div id="cam-layer">
                <div id="vignette"></div>
                <div id="scanlines"></div>
                <div id="static"></div>
                <div id="glitch-layer"></div>
            </div>
            
            <div id="rec-dot"></div>
            <div id="cam-info">–ö–ê–ú 01</div>
            <div id="level-indicator">LVL 1/20</div>
            <div id="time-display">00:00:00</div>
            
            <div id="rooms-mount"></div>

            <div id="report-overlay">
                <h3 style="color:red; margin-bottom:20px; background:black; padding:5px; border: 1px solid red; text-transform: uppercase; letter-spacing: 2px;">–¢–ò–ü –£–ì–†–û–ó–´</h3>
                <div class="rep-group">
                    <div class="rep-type" onclick="checkAnswer('ghost')">–ü–†–ò–ó–†–ê–ö / –¢–ï–ù–¨</div>
                    <div class="rep-type" onclick="checkAnswer('move')">–ü–ï–†–ï–ú–ï–©–ï–ù–ò–ï</div>
                    <div class="rep-type" onclick="checkAnswer('extra')">–õ–ò–®–ù–ò–ô –ü–†–ï–î–ú–ï–¢</div>
                    <div class="rep-type" onclick="checkAnswer('missing')">–ò–°–ß–ï–ó–ù–û–í–ï–ù–ò–ï</div>
                    <div class="rep-type" onclick="checkAnswer('morph')">–ò–°–ö–ê–ñ–ï–ù–ò–ï</div>
                    <div class="rep-type" onclick="checkAnswer('text')">–ù–ê–î–ü–ò–°–¨</div>
                    <div class="rep-type" onclick="checkAnswer('camera')">–°–ë–û–ô –ö–ê–ú–ï–†–´</div>
                    <div class="rep-type" onclick="checkAnswer('intruder')">–í–¢–û–†–ñ–ï–ù–ò–ï</div>
                    <div class="rep-type" onclick="checkAnswer('sound')" style="grid-column: span 2; color: #fa0; border-color: #fa0;">–°–¢–†–ê–ù–ù–´–ô –ó–í–£–ö</div>
                </div>
                <button style="margin-top:20px; padding:10px 30px; background:#222; color:#aaa; border:none; cursor:pointer;" onclick="toggleReport()">–û–¢–ú–ï–ù–ê</button>
            </div>
        </div>
    </div>

    <div id="control-panel">
        <div id="status-display">–û–ñ–ò–î–ê–ù–ò–ï...</div>
        
        <div id="cam-grid">
            <button class="cam-btn active" onclick="switchCam(0)">01<span>–°–ü–ê–õ–¨–ù–Ø</span></button>
            <button class="cam-btn" onclick="switchCam(1)">02<span>–ö–£–•–ù–Ø</span></button>
            <button class="cam-btn" onclick="switchCam(2)">03<span>–ó–ê–õ</span></button>
            <button class="cam-btn" onclick="switchCam(3)">04<span>–í–ê–ù–ù–ê–Ø</span></button>
            <button class="cam-btn" onclick="switchCam(4)">05<span>–ö–û–†–ò–î–û–†</span></button>
            <button class="cam-btn" onclick="switchCam(5)">06<span>–ü–û–î–í–ê–õ</span></button>
            <button class="cam-btn" onclick="switchCam(6)">07<span>–ì–ê–†–ê–ñ</span></button>
            <button class="cam-btn" onclick="switchCam(7)">08<span>–ö–õ–ê–î–û–í–ê–Ø</span></button>
        </div>

        <button class="action-btn" id="clean-btn" onclick="checkAnswer('none')">–ê–ù–û–ú–ê–õ–ò–ô –ù–ï–¢</button>
        <button class="action-btn" id="report-btn" onclick="toggleReport()">–û–¢–ü–†–ê–í–ò–¢–¨ –†–ï–ü–û–†–¢</button>
        <button class="action-btn" id="guide-btn" onclick="toggleGuide()">–†–£–ö–û–í–û–î–°–¢–í–û</button>
    </div>

    <script>
        const MAX_LEVEL = 20;
        
        // --- DETAILED ROOM LAYOUTS (FULL RESTORE) ---
        const ROOM_LAYOUTS = [
            {
                name: "–°–ü–ê–õ–¨–ù–Ø", wall: "#403a3a",
                items: [
                    { id: 'bed', shape: 'shape-bed', w:40, h:20, x:10, y:65, z:5 },
                    { id: 'pillow', shape: 'shape-pillow', w:12, h:7, x:13, y:62, z:6 },
                    { id: 'win', type: 'window', w:20, h:30, x:45, y:15, z:1 },
                    { id: 'win-v', className:'window-frame-v', childOf:'win' }, { id: 'win-h', className:'window-frame-h', childOf:'win' },
                    { id: 'poster', type: 'poster', text:'–°–û–ù', w:10, h:12, x:75, y:20, z:2 },
                    { id: 'dummy', w:10, h:35, x:20, y:50, z:6 },
                    { id: 'd-base', className:'dummy-base', childOf:'dummy', w:100, h:30, x:0, y:70, z:6 },
                    { id: 'd-pole', className:'dummy-pole', childOf:'dummy', w:15, h:30, x:42, y:40, z:5 },
                    { id: 'd-torso', className:'dummy-torso', childOf:'dummy', w:60, h:40, x:20, y:15, z:6 },
                    { id: 'd-head', className:'dummy-head', childOf:'dummy', w:30, h:15, x:35, y:0, z:6 },
                    { id: 'clock', shape: 'shape-clock', w:6, h:8, x:85, y:15, z:5 },
                    { id: 'rug', bg:'#222', w:25, h:10, x:55, y:75, z:2, style:'border-radius:50%; transform:scaleY(0.5); opacity:0.5;' },
                    { id: 'cal', type: 'poster-paper', text:'12.24', w:5, h:6, x:10, y:25, z:2 }
                ]
            },
            {
                name: "–ö–£–•–ù–Ø", wall: "#555",
                items: [
                    { id: 'fridge', shape: 'shape-fridge', w:20, h:55, x:5, y:20, z:4 },
                    { id: 'fh1', className: 'fridge-handle-top', childOf: 'fridge' },
                    { id: 'fnote', className: 'fridge-note', childOf: 'fridge' },
                    { id: 'table', type: 'furniture', bg:'#3e2723', w:30, h:20, x:35, y:60, z:5 },
                    { id: 'win2', type: 'window', w:25, h:20, x:40, y:10, z:1 },
                    { id: 'win2-v', className:'window-frame-v', childOf:'win2' }, { id: 'win2-h', className:'window-frame-h', childOf:'win2' },
                    { id: 'cup', shape: 'shape-cup', w:4, h:6, x:45, y:54, z:6 }, 
                    { id: 'poster2', type: 'poster', text:'–ï–î–ê', w:10, h:10, x:80, y:20, z:2 },
                    { id: 'monstera', shape: 'shape-monstera-pot', w:8, h:10, x:85, y:65, z:5 },
                    { id: 'leaf1', className: 'monstera-leaf', w:8, h:6, x:84, y:60, z:4, style: 'transform: rotate(-30deg);' },
                    { id: 'leaf2', className: 'monstera-leaf', w:7, h:6, x:88, y:59, z:4, style: 'transform: rotate(30deg);' }
                ]
            },
            {
                name: "–ó–ê–õ", wall: "#4a403a",
                items: [
                    { id: 'winL', type: 'window', w:20, h:30, x:10, y:10, z:1 },
                    { id: 'winL-v', className:'window-frame-v', childOf:'winL' }, { id: 'winL-h', className:'window-frame-h', childOf:'winL' },
                    { id: 'tvstand', shape: 'shape-long-stand', w:40, h:10, x:55, y:60, z:5 },
                    { id: 'tv', shape: 'shape-tv-flat', w:30, h:20, x:60, y:40, z:5 },
                    { id: 'sofa', shape: 'shape-sofa', w:40, h:15, x:5, y:65, z:5 },
                    { id: 'rug', className: 'shape-rug-large', w:40, h:15, x:30, y:75, z:2 },
                    { id: 'paint', type: 'poster-dark', text:'', w:15, h:25, x:40, y:15, z:1 },
                    { id: 'plantBig', shape: 'shape-monstera-pot', w:8, h:12, x:90, y:72, z:6 },
                    { id: 'leafB1', className: 'monstera-leaf', w:10, h:8, x:88, y:65, z:5 },
                    { id: 'flyer', type: 'poster-paper', text:'INFO', w:4, h:5, x:32, y:40, z:1 }
                ]
            },
            {
                name: "–í–ê–ù–ù–ê–Ø", wall: "#2c3e50", 
                items: [
                    { id: 'mirror', bg:'#556', w:15, h:20, x:42, y:15, z:2, style:'border:2px solid #333' },
                    { id: 'bath', type: 'furniture', bg:'#ddd', w:40, h:25, x:5, y:55, z:4 },
                    { id: 'duck', shape: 'shape-rubber-duck', w:6, h:4, x:30, y:52, z:6 },
                    { id: 'toilet', shape: 'shape-toilet-new', w:12, h:25, x:80, y:55, z:4 },
                    { id: 'ttank', className: 'toilet-tank', childOf: 'toilet' },
                    { id: 'tbowl', className: 'toilet-bowl', childOf: 'toilet' },
                    { id: 'sign', type: 'poster', text:'–í–û–î–ê', w:8, h:4, x:60, y:20, z:2 },
                    { id: 'shampoo', bg:'#c2185b', w:3, h:5, x:10, y:50, z:5, style:'border-radius:2px;' }
                ]
            },
            {
                name: "–ö–û–†–ò–î–û–†", wall: "#3e2723",
                items: [
                    { id: 'door', bg:'#1a100a', w:18, h:60, x:41, y:15, z:1, style:'border:2px solid black' },
                    { id: 'exit', type: 'poster', text:'–í–´–•–û–î', bg:'#003300', w:12, h:4, x:44, y:8, z:2, style:'color:#5f5; font-size:10px;' },
                    { id: 'rug', shape: 'shape-rug', w:25, h:10, x:38, y:72, z:2 },
                    { id: 'rack', shape: 'shape-rack', w:4, h:50, x:75, y:25, z:5 },
                    { id: 'clight', shape: 'shape-clight-small', w:4, h:4, x:48, y:2, z:5 },
                    { id: 'notice', type: 'poster-paper', text:'–¢–ò–®–ò–ù–ê', w:8, h:6, x:20, y:30, z:1 },
                    { id: 'extinguisher', shape: 'shape-extinguisher', w:4, h:12, x:65, y:58, z:5 },
                    { id: 'box_c', shape: 'shape-box', w:10, h:10, x:10, y:65, z:4 },
                    { id: 'vent', className: 'vent-grill', w:10, h:5, x:10, y:10, z:1 }
                ]
            },
            {
                name: "–ü–û–î–í–ê–õ", wall: "grunge",
                items: [
                    { id: 'pipe1', bg:'#444', w:100, h:4, x:0, y:10, z:3, style:'border-bottom:1px solid #111;' },
                    { id: 'pipe2', bg:'#333', w:5, h:60, x:15, y:10, z:1 },
                    { id: 'bench', shape: 'shape-workbench', w:35, h:5, x:50, y:60, z:5 },
                    { id: 'leg1_real', bg:'#222', w:3, h:15, x:52, y:65, z:4 },
                    { id: 'leg2_real', bg:'#222', w:3, h:15, x:80, y:65, z:4 },
                    { id: 'tools', shape: 'shape-toolboard', w:25, h:15, x:55, y:35, z:2 },
                    { id: 'hammer', className: 'tool-hammer', w:5, h:10, x:58, y:38, z:3, style:'transform: rotate(15deg);' },
                    { id: 'wrench', className: 'tool-wrench', w:4, h:8, x:65, y:39, z:3 },
                    { id: 'sign3', className: 'poster-straight', text:'–û–ü–ê–°–ù–û', w:12, h:6, x:10, y:30, z:2 }
                ]
            },
            {
                name: "–ì–ê–†–ê–ñ", wall: "#222",
                items: [
                    { id: 'cabinet', shape: 'shape-cabinet', w:15, h:30, x:10, y:45, z:4 },
                    { id: 'd1', className: 'cabinet-drawer', childOf: 'cabinet' },
                    { id: 'd2', className: 'cabinet-drawer', childOf: 'cabinet' },
                    { id: 'd3', className: 'cabinet-drawer', childOf: 'cabinet' },
                    { id: 'tires', shape: 'shape-tire-stack', w:12, h:10, x:80, y:65, z:4 },
                    { id: 'tires2', shape: 'shape-tire-stack', w:12, h:10, x:80, y:55, z:4 },
                    { id: 'barrel', shape: 'shape-barrel-blue', w:10, h:15, x:65, y:60, z:4 },
                    { id: 'boxg1', bg:'#4e342e', w:10, h:10, x:30, y:65, z:3, style:'border:1px solid #3e2723;' },
                    { id: 'boxg2', bg:'#3e2723', w:8, h:8, x:38, y:67, z:4, style:'border:1px solid #2e1c11;' },
                    { id: 'poster_g', type: 'poster', text:'–ì–ê–†–ê–ñ', bg:'#111', color:'#ccc', w:15, h:8, x:40, y:20, z:2 },
                    { id: 'fix', type: 'poster-paper', text:'–†–ï–ú–û–ù–¢', w:8, h:5, x:60, y:30, z:1 }
                ]
            },
            {
                name: "–ö–õ–ê–î–û–í–ê–Ø", wall: "#6d4c41",
                items: [
                    { id: 'shelf1', shape: 'shape-rack-shelf', w:80, h:5, x:10, y:20, z:2 },
                    { id: 'shelf2', shape: 'shape-rack-shelf', w:80, h:5, x:10, y:50, z:2 },
                    { id: 'shelf3', shape: 'shape-rack-shelf', w:80, h:5, x:10, y:80, z:2 },
                    { id: 'jar1', shape: 'shape-jar', w:5, h:8, x:20, y:12, z:3 },
                    { id: 'jar2', shape: 'shape-jar', w:5, h:8, x:30, y:12, z:3 },
                    { id: 'jar3', shape: 'shape-jar', w:6, h:10, x:60, y:40, z:3 },
                    { id: 'box1', bg:'#4e342e', w:12, h:12, x:15, y:38, z:3, style:'border:1px solid #3e2723;' },
                    { id: 'inv', type: 'poster-paper', text:'–£–ß–Å–¢', w:6, h:6, x:5, y:35, z:1 }
                ]
            }
        ];

        let currentLevel = 1;
        let currentCam = 0;
        let anomalyData = { active: false, type: 'none', roomId: -1, description: '', specificId: '' };
        let anomalyTimer = null;
        let isGameOver = false;

        // --- AUDIO SYSTEM (BALANCED) ---
        const AudioSys = {
            ctx: null,
            masterGain: null,
            currentLoopNode: null, 
            
            init: function() {
                if(!this.ctx) {
                    this.ctx = new (window.AudioContext || window.webkitAudioContext)();
                    this.masterGain = this.ctx.createGain();
                    this.masterGain.connect(this.ctx.destination);
                    this.startSilentAmbience();
                }
                if(this.ctx.state === 'suspended') this.ctx.resume();
            },

            startSilentAmbience: function() {
                const bSize = this.ctx.sampleRate * 2;
                const b = this.ctx.createBuffer(1, bSize, this.ctx.sampleRate);
                const d = b.getChannelData(0);
                for (let i = 0; i < bSize; i++) d[i] = (Math.random() * 2 - 1) * 0.1;
                const node = this.ctx.createBufferSource();
                node.buffer = b; node.loop = true;
                const filter = this.ctx.createBiquadFilter(); filter.type = 'lowpass'; filter.frequency.value = 100;
                const gain = this.ctx.createGain(); gain.gain.value = 0.05;
                node.connect(filter); filter.connect(gain); gain.connect(this.masterGain);
                node.start();
            },

            playClick: function() {
                if(!this.ctx) return;
                const osc = this.ctx.createOscillator();
                const gain = this.ctx.createGain();
                osc.type = 'square'; osc.frequency.value = 100; 
                gain.gain.setValueAtTime(0.05, this.ctx.currentTime);
                gain.gain.exponentialRampToValueAtTime(0.001, this.ctx.currentTime + 0.05);
                osc.connect(gain); gain.connect(this.masterGain);
                osc.start(); osc.stop(this.ctx.currentTime + 0.05);
            },

            stopScaryLoop: function() {
                if (this.currentLoopNode) {
                    try { this.currentLoopNode.stop(); } catch(e){}
                    this.currentLoopNode = null;
                }
            },

            playScarySound: function(type, loop = false) {
                if(!this.ctx) this.init();
                this.stopScaryLoop();

                const t = this.ctx.currentTime;
                
                if(type === 'breathing') {
                    const bSize = this.ctx.sampleRate * 2; 
                    const b = this.ctx.createBuffer(1, bSize, this.ctx.sampleRate);
                    const d = b.getChannelData(0); for(let i=0; i<bSize; i++) d[i] = (Math.random() * 2 - 1);
                    
                    const noise = this.ctx.createBufferSource(); 
                    noise.buffer = b; 
                    noise.loop = loop;

                    const filt = this.ctx.createBiquadFilter(); filt.type = 'lowpass'; filt.frequency.value = 600;
                    const gain = this.ctx.createGain(); 
                    
                    const lfo = this.ctx.createOscillator();
                    lfo.frequency.value = 0.5;
                    const lfoGain = this.ctx.createGain();
                    lfoGain.gain.value = 0.15; 
                    lfo.connect(lfoGain);
                    lfoGain.connect(gain.gain);
                    gain.gain.value = 0.05; 

                    noise.connect(filt); filt.connect(gain); gain.connect(this.masterGain);
                    noise.start(); lfo.start();
                    
                    this.currentLoopNode = noise; 
                } 
                else if (type === 'thud') {
                    const osc = this.ctx.createOscillator();
                    osc.type = 'square';
                    osc.frequency.value = 50;
                    
                    const gain = this.ctx.createGain();
                    
                    const lfo = this.ctx.createOscillator();
                    lfo.type = 'square';
                    lfo.frequency.value = 1;
                    const lfoGain = this.ctx.createGain();
                    lfoGain.gain.value = 0.4; 
                    lfo.connect(lfoGain);
                    lfoGain.connect(gain.gain);
                    
                    osc.connect(gain); gain.connect(this.masterGain);
                    osc.start(); lfo.start();
                    this.currentLoopNode = osc;
                }
                else if (type === 'whine') {
                    const osc = this.ctx.createOscillator(); 
                    osc.type = 'sawtooth';
                    osc.frequency.value = 8000;
                    const gain = this.ctx.createGain();
                    gain.gain.value = 0.04; 
                    osc.connect(gain); gain.connect(this.masterGain);
                    osc.start();
                    this.currentLoopNode = osc;
                } 
                else if (type === 'whisper') {
                    const bSize = this.ctx.sampleRate * 1; 
                    const b = this.ctx.createBuffer(1, bSize, this.ctx.sampleRate);
                    const d = b.getChannelData(0); for(let i=0; i<bSize; i++) d[i] = (Math.random() * 2 - 1);
                    const noise = this.ctx.createBufferSource(); noise.buffer = b; noise.loop = loop;
                    
                    const filt = this.ctx.createBiquadFilter(); filt.type = 'highpass'; filt.frequency.value = 1200;
                    const gain = this.ctx.createGain(); 
                    gain.gain.value = 0.1; 
                    
                    noise.connect(filt); filt.connect(gain); gain.connect(this.masterGain);
                    noise.start();
                    this.currentLoopNode = noise;
                }
                
                if (!loop) {
                    setTimeout(() => { if(this.currentLoopNode === this.currentLoopNode) this.stopScaryLoop(); }, 2000);
                }
            }
        };

        function initGame() {
            document.getElementById('fullscreen-msg').style.display = 'none';
            isGameOver = false;
            AudioSys.init();
            
            const mount = document.getElementById('rooms-mount');
            mount.innerHTML = '';
            
            ROOM_LAYOUTS.forEach((layout, idx) => {
                const r = document.createElement('div');
                r.className = 'room-container';
                r.id = `room-${idx}`;
                if(idx === 0) r.classList.add('visible');
                
                const w = document.createElement('div'); w.className = 'wall'; 
                if(layout.wall === 'grunge') w.classList.add('wall-grunge');
                else w.style.background = layout.wall;
                
                const f = document.createElement('div'); f.className = 'floor';
                r.appendChild(w); r.appendChild(f);

                layout.items.forEach((item, itemIdx) => {
                    if(!item.childOf) {
                        createObject(r, item, idx, itemIdx);
                    }
                });
                layout.items.forEach((item, itemIdx) => {
                    if(item.childOf) {
                        const parent = document.getElementById(`r${idx}-${item.childOf}`);
                        if(parent) {
                            const el = document.createElement('div');
                            el.className = item.className || '';
                            if(item.id) el.id = `r${idx}-${item.id}`; 
                            parent.appendChild(el);
                        }
                    }
                });
                mount.appendChild(r);
            });
            startLevel(1);
            setInterval(updateTime, 1000);
        }

        function updateTime() {
            const now = new Date();
            document.getElementById('time-display').innerText = now.toLocaleTimeString('ru-RU', {hour12:false});
        }

        function createObject(parent, item, roomId, objIdPrefix) {
            const el = document.createElement('div');
            el.className = `obj ${item.type || ''} ${item.shape || ''} ${item.className || ''}`;
            el.id = `r${roomId}-${item.id}`; 
            el.style.left = item.x + '%';
            el.style.top = item.y + '%';
            el.style.width = item.w + '%';
            el.style.height = item.h + '%';
            el.style.zIndex = item.z;
            if(item.bg) el.style.background = item.bg;
            if(item.color) el.style.color = item.color;
            if(item.text) el.innerText = item.text;
            if(item.style) el.style.cssText += item.style;
            
            // --- BUG FIX: SAVE ORIGINAL STYLES ---
            el.dataset.origLeft = item.x + '%';
            el.dataset.origTop = item.y + '%';
            el.dataset.origW = item.w + '%';
            el.dataset.origH = item.h + '%';
            el.dataset.origText = item.text || '';
            el.dataset.origClass = el.className;
            el.dataset.origTransform = item.style && item.style.includes('transform') ? item.style.match(/transform:\s*([^;]+)/)[1] : 'none';
            el.dataset.origOpacity = item.style && item.style.includes('opacity') ? item.style.match(/opacity:\s*([^;]+)/)[1] : '1';
            
            // Explicitly save colors and radius for reset
            el.dataset.origRadius = el.style.borderRadius || '';
            el.dataset.origColor = el.style.color || '';
            el.dataset.origBg = el.style.backgroundColor || '';
            
            parent.appendChild(el);
        }

        function startLevel(lvl) {
            currentLevel = lvl;
            document.getElementById('level-indicator').innerText = `LVL ${lvl}/${MAX_LEVEL}`;
            document.getElementById('status-display').innerText = "–°–ö–ê–ù–ò–†–û–í–ê–ù–ò–ï...";
            document.getElementById('status-display').style.color = "#555";
            resetRooms();
            if(anomalyTimer) clearTimeout(anomalyTimer);
            const st = document.getElementById('static');
            st.classList.add('static-active');
            AudioSys.playClick();
            setTimeout(() => {
                st.classList.remove('static-active');
                document.getElementById('status-display').innerText = "–°–ò–°–¢–ï–ú–ê –í –ù–û–†–ú–ï";
                document.getElementById('status-display').style.color = "#2a2";
                scheduleAnomaly();
            }, 300);
        }

        function resetRooms() {
            AudioSys.stopScaryLoop();
            document.querySelectorAll('.temp-anomaly').forEach(el => el.remove());
            document.getElementById('glitch-layer').style.display = 'none';
            
            document.querySelectorAll('.obj').forEach(el => {
                el.style.left = el.dataset.origLeft;
                el.style.top = el.dataset.origTop;
                el.style.width = el.dataset.origW;
                el.style.height = el.dataset.origH;
                if(el.dataset.origText) el.innerText = el.dataset.origText;
                el.className = el.dataset.origClass;
                el.style.transform = el.dataset.origTransform === 'undefined' ? 'none' : el.dataset.origTransform;
                el.style.opacity = el.dataset.origOpacity;
                el.style.display = 'block'; 
                el.style.filter = '';
                
                // --- BUG FIX: RESET STYLE PROPERTIES ---
                el.style.borderRadius = el.dataset.origRadius;
                el.style.color = el.dataset.origColor;
                // Specific fix for posters that might have been changed
                if(el.className.includes('poster') && !el.className.includes('paper')) {
                     el.style.backgroundColor = "#ccc"; // Default poster
                     if(el.id && el.id.includes('poster_g')) el.style.backgroundColor = '#111'; // Garage special
                } else {
                     el.style.backgroundColor = el.dataset.origBg;
                }
            });
            document.querySelectorAll('.room-container').forEach(r => {
                r.style.filter = 'brightness(0.95) sepia(0.2) contrast(1.1)'; 
            });
            anomalyData = { active: false, type: 'none', roomId: -1, description: '', specificId: '' };
        }

        function scheduleAnomaly() {
            if(Math.random() > 0.3) { 
                const delay = Math.random() * 5000 + 2000;
                anomalyTimer = setTimeout(triggerAnomaly, delay);
            } else {
                anomalyData.type = 'none';
                anomalyData.active = false;
                console.log("CLEAN LEVEL");
            }
        }

        function triggerAnomaly() {
            if(isGameOver) return;
            anomalyData.active = true;
            
            const roomId = Math.floor(Math.random() * ROOM_LAYOUTS.length);
            const roomEl = document.getElementById(`room-${roomId}`);
            const allObjs = Array.from(roomEl.querySelectorAll('.obj:not([id*="leaf"]):not([id*="tbowl"]):not([id*="ttank"]):not([id*="d-"]):not([id*="fnote"]):not([id*="fh1"])')); 
            const target = allObjs[Math.floor(Math.random() * allObjs.length)];
            const roomName = ROOM_LAYOUTS[roomId].name;
            anomalyData.roomId = roomId;

            const categories = [
                'ghost', 'ghost', 
                'move', 'move',
                'extra', 'extra', 
                'missing', 
                'morph', 
                'text', 'text',
                'camera', 
                'intruder', 
                'sound', 'sound'
            ];
            
            const mainType = categories[Math.floor(Math.random() * categories.length)];
            console.log(`ANOMALY: ${mainType} in ${roomName}`);

            switch(mainType) {
                case 'ghost':
                    anomalyData.type = 'ghost';
                    const ghostSub = Math.random();
                    if(ghostSub < 0.5) {
                        const g = document.createElement('div'); g.className = 'ghost-subtle temp-anomaly';
                        g.style.left = (Math.random()*60+20)+'%'; g.style.top = '30%';
                        roomEl.appendChild(g);
                        anomalyData.description = "–ï–¥–≤–∞ –∑–∞–º–µ—Ç–Ω—ã–π —Å–∏–ª—É—ç—Ç.";
                    } else {
                        const s = document.createElement('div'); s.className = 'shadow-corner temp-anomaly';
                        s.style.top = '0'; s.style.left = '0'; s.style.transform = 'rotate(180deg)';
                        roomEl.appendChild(s);
                        anomalyData.description = "–¢–µ–Ω—å –≤ —É–≥–ª—É –ø–æ—Ç–æ–ª–∫–∞.";
                    }
                    break;

                case 'move':
                    anomalyData.type = 'move';
                    if(!target) { triggerAnomaly(); return; }
                    
                    const moveType = Math.random();
                    let transformString = target.dataset.origTransform === 'none' ? '' : target.dataset.origTransform;
                    
                    if(moveType < 0.4) {
                        const x = (Math.random() * 6 - 3); 
                        const y = (Math.random() * 4 - 2); 
                        target.style.transform = `${transformString} translate(${x}%, ${y}%)`;
                    } else if (moveType < 0.8) {
                        const deg = (Math.random() * 10 - 5); 
                        target.style.transform = `${transformString} rotate(${deg}deg)`;
                    } else {
                        target.style.transform = `${transformString} scale(1.1)`;
                    }
                    anomalyData.description = "–ü—Ä–µ–¥–º–µ—Ç –Ω–µ–º–Ω–æ–≥–æ —Å–¥–≤–∏–Ω—É–ª—Å—è.";
                    break;

                case 'extra':
                    anomalyData.type = 'extra';
                    const ex = document.createElement('div');
                    ex.className = 'obj temp-anomaly';
                    ex.style.zIndex = 20;
                    
                    const exR = Math.random();
                    if(exR < 0.3) {
                        ex.style.width = '3%'; ex.style.height = '4%'; ex.style.background = '#222';
                        ex.style.left = (Math.random()*80+10)+'%'; ex.style.top = (Math.random()*30+50)+'%';
                    } else if (exR < 0.6) {
                        ex.style.width = '2%'; ex.style.height = '3%'; ex.style.background = '#ddd';
                        ex.style.left = (Math.random()*80+10)+'%'; ex.style.top = (Math.random()*30+40)+'%';
                    } else {
                        ex.style.width = '5%'; ex.style.height = '5%'; ex.style.background = 'black';
                        ex.style.borderRadius = '50%'; ex.style.filter = 'blur(5px)';
                        ex.style.left = (Math.random()*80)+'%'; ex.style.top = (Math.random()*40)+'%';
                    }
                    roomEl.appendChild(ex);
                    anomalyData.description = "–ú–∞–ª–µ–Ω—å–∫–∏–π –ª–∏—à–Ω–∏–π –ø—Ä–µ–¥–º–µ—Ç.";
                    break;

                case 'missing':
                    anomalyData.type = 'missing';
                    const smallItems = allObjs.filter(o => o.style.width && parseInt(o.style.width) < 10);
                    const targetMiss = smallItems.length > 0 ? smallItems[Math.floor(Math.random()*smallItems.length)] : target;
                    if(targetMiss) {
                        targetMiss.style.display = 'none';
                        anomalyData.description = "–ü—Ä–æ–ø–∞–ª –º–µ–ª–∫–∏–π –ø—Ä–µ–¥–º–µ—Ç.";
                    } else triggerAnomaly();
                    break;

                case 'morph':
                    anomalyData.type = 'morph';
                    if(!target) { triggerAnomaly(); return; }
                    if(Math.random() < 0.5) {
                        target.style.filter = "brightness(0.3)"; 
                    } else {
                        target.style.borderRadius = "50%"; 
                    }
                    anomalyData.description = "–ü—Ä–µ–¥–º–µ—Ç –∏–∑–º–µ–Ω–∏–ª—Å—è.";
                    break;

                case 'text':
                    anomalyData.type = 'text';
                    const posters = Array.from(roomEl.querySelectorAll('.poster, .poster-paper'));
                    const phrases = ["–û–ù–ò –ó–î–ï–°–¨", "–ù–ï –°–ü–ò", "–ë–ï–ì–ò", "–ö–†–û–í–¨", "3:00", "–ü–û–ú–û–ì–ò"];
                    const chosen = phrases[Math.floor(Math.random()*phrases.length)];

                    if(posters.length > 0) {
                        const p = posters[0];
                        p.innerText = chosen;
                        p.style.backgroundColor = "#522"; 
                    } else {
                        const txt = document.createElement('div');
                        txt.className = 'obj temp-anomaly scary-text';
                        txt.innerText = chosen;
                        txt.style.fontSize = "8px";
                        txt.style.top = "40%"; txt.style.left = "40%"; opacity: 0.8;
                        roomEl.appendChild(txt);
                    }
                    anomalyData.description = "–ò–∑–º–µ–Ω–µ–Ω–∏–µ –Ω–∞–¥–ø–∏—Å–∏.";
                    break;

                case 'camera':
                    anomalyData.type = 'camera';
                    const camSub = Math.random();
                    if(camSub < 0.5) {
                        roomEl.style.filter = "brightness(0.4)";
                        anomalyData.description = "–°–±–æ–π —è—Ä–∫–æ—Å—Ç–∏ –∫–∞–º–µ—Ä—ã.";
                    } else {
                        roomEl.style.filter = "blur(2px) contrast(0.8)";
                        anomalyData.description = "–†–∞—Å—Ñ–æ–∫—É—Å–∏—Ä–æ–≤–∫–∞.";
                    }
                    break;

                case 'intruder':
                    anomalyData.type = 'intruder';
                    const win = roomEl.querySelector('.window, .door');
                    if(win) {
                        const fig = document.createElement('div');
                        fig.className = 'intruder-dark temp-anomaly';
                        win.appendChild(fig);
                        anomalyData.description = "–°–∏–ª—É—ç—Ç –≤ –ø—Ä–æ–µ–º–µ.";
                    } else triggerAnomaly();
                    break;

                case 'sound':
                    anomalyData.type = 'sound';
                    anomalyData.soundType = ['breathing', 'thud', 'whine', 'whisper'][Math.floor(Math.random()*4)];
                    anomalyData.description = `–°–ª—ã—à–µ–Ω –∑–≤—É–∫: ${anomalyData.soundType}`;
                    if(currentCam === roomId) {
                        AudioSys.playScarySound(anomalyData.soundType, true);
                    }
                    break;
            }
        }

        function switchCam(id) {
            AudioSys.playClick();
            
            AudioSys.stopScaryLoop();
            if(anomalyData.active && anomalyData.type === 'sound' && anomalyData.roomId === id) {
                AudioSys.playScarySound(anomalyData.soundType, true);
            }

            document.querySelectorAll('.cam-btn').forEach(b => b.classList.remove('active'));
            document.querySelectorAll('.cam-btn')[id].classList.add('active');
            document.querySelectorAll('.room-container').forEach(r => r.classList.remove('visible'));
            document.getElementById(`room-${id}`).classList.add('visible');
            currentCam = id;
            document.getElementById('cam-info').innerText = `–ö–ê–ú 0${id+1}`;
            
            const st = document.getElementById('static');
            st.classList.add('static-active');
            setTimeout(() => st.classList.remove('static-active'), 150);
        }

        function toggleReport() {
            const el = document.getElementById('report-overlay');
            el.style.display = el.style.display === 'flex' ? 'none' : 'flex';
        }

        function toggleGuide() {
            const el = document.getElementById('guide-overlay');
            el.style.display = el.style.display === 'flex' ? 'none' : 'flex';
        }

        function checkAnswer(userChoice) {
            document.getElementById('report-overlay').style.display = 'none';
            if(userChoice === 'none') {
                if(anomalyData.active) {
                    gameOver(false, `–û—à–∏–±–∫–∞. –ü—Ä–æ–ø—É—â–µ–Ω–æ: ${anomalyData.description} (–ö–æ–º–Ω–∞—Ç–∞ ${ROOM_LAYOUTS[anomalyData.roomId].name})`);
                } else {
                    nextLevel();
                }
                return;
            }

            if(!anomalyData.active) {
                gameOver(false, "–ê–Ω–æ–º–∞–ª–∏–∏ –Ω–µ—Ç. –í—ã –æ—à–∏–±–ª–∏—Å—å.");
                return;
            }

            if(anomalyData.roomId !== currentCam) {
                gameOver(false, `–ê–Ω–æ–º–∞–ª–∏—è –±—ã–ª–∞ –≤ –¥—Ä—É–≥–æ–π –∫–æ–º–Ω–∞—Ç–µ: ${ROOM_LAYOUTS[anomalyData.roomId].name}.`);
                return;
            }

            let isCorrect = (userChoice === anomalyData.type);
            if(anomalyData.type === 'ghost' && userChoice === 'intruder') isCorrect = true; 
            if(anomalyData.type === 'intruder' && userChoice === 'ghost') isCorrect = true; 
            if(anomalyData.type === 'camera' && userChoice === 'ghost') isCorrect = false; 

            if(isCorrect) {
                nextLevel();
            } else {
                gameOver(false, `–ù–µ–≤–µ—Ä–Ω—ã–π —Ç–∏–ø. <br>–í—ã–±—Ä–∞–Ω–æ: ${userChoice} <br>–ë—ã–ª–æ: ${anomalyData.type.toUpperCase()}`);
            }
        }

        function nextLevel() {
            if(currentLevel >= MAX_LEVEL) {
                gameOver(true, "–°–ú–ï–ù–ê –û–ö–û–ù–ß–ï–ù–ê. –ü–û–¢–ï–†–¨ –ù–ï–¢.");
            } else {
                startLevel(currentLevel + 1);
            }
        }

        function gameOver(win, reason) {
            isGameOver = true;
            if(anomalyTimer) clearTimeout(anomalyTimer);
            AudioSys.stopScaryLoop();
            
            const scr = document.getElementById('fullscreen-msg');
            scr.style.display = 'flex';
            scr.innerHTML = '';
            
            const h1 = document.createElement('h1');
            h1.style.color = win ? '#2a2' : '#a22';
            h1.innerText = win ? "–°–ú–ï–ù–ê –ó–ê–í–ï–†–®–ï–ù–ê" : "–ù–ê–†–£–®–ï–ù–ò–ï –ü–†–û–¢–û–ö–û–õ–ê";
            
            const p = document.createElement('p');
            p.style.color = '#ccc'; p.style.maxWidth = '600px'; p.innerHTML = reason;
            
            const btn = document.createElement('button');
            btn.innerText = "–ü–ï–†–ï–ó–ê–ì–†–£–ó–ö–ê";
            btn.style.marginTop = "20px"; btn.style.padding = "10px 30px"; btn.style.cursor = "pointer";
            btn.onclick = () => location.reload();
            
            scr.appendChild(h1);
            scr.appendChild(p);
            scr.appendChild(btn);
        }
    </script>
</body>
</html>
<!-- END OF FILE ai_studio_code (Bugfix_Reset_System).html -->
