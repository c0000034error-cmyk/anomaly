<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <title>OBSERVATION DUTY: ULTRA HARDCORE</title>
    <style>
        :root {
            --bg-color: #050505;
            --ui-bg: #141414;
            --text: #00ff41;
            --text-dim: #005515;
            --alert: #ff3333;
        }
        body { margin: 0; background: #000; height: 100vh; font-family: 'Courier New', monospace; overflow: hidden; user-select: none; display: flex; }

        /* --- –ú–û–ù–ò–¢–û–† --- */
        #monitor-frame {
            flex: 3; background: #0a0a0a; padding: 20px;
            display: flex; flex-direction: column; position: relative;
        }
        #screen {
            flex-grow: 1; background: #000; position: relative;
            border: 4px solid #222; overflow: hidden;
            box-shadow: inset 0 0 80px #000;
        }
        
        /* –≠–§–§–ï–ö–¢–´ */
        #scanlines {
            position: absolute; inset: 0; pointer-events: none; z-index: 50;
            background: linear-gradient(rgba(18,16,16,0) 50%, rgba(0,0,0,0.1) 50%); background-size: 100% 4px;
        }
        #static {
            position: absolute; inset: 0; pointer-events: none; z-index: 60; opacity: 1;
            background-image: url('data:image/svg+xml,<svg xmlns="http://www.w3.org/2000/svg" width="200" height="200"><filter id="n"><feTurbulence type="fractalNoise" baseFrequency="0.65"/></filter><rect width="100%" height="100%" filter="url(%23n)"/></svg>');
            transition: opacity 0.3s;
        }
        #cam-info {
            position: absolute; top: 20px; left: 20px; color: white;
            background: rgba(0,0,0,0.8); padding: 5px 15px; z-index: 40; font-size: 24px; border-left: 3px solid var(--text);
        }
        #level-indicator {
            position: absolute; top: 20px; right: 20px; color: var(--text);
            font-weight: bold; z-index: 40; font-size: 24px; text-shadow: 0 0 10px var(--text);
        }
        #rec-dot {
            position: absolute; top: 25px; right: 150px; width: 15px; height: 15px;
            background: red; border-radius: 50%; z-index: 40; animation: blink 1s infinite;
        }

        /* --- –ü–£–õ–¨–¢ --- */
        #control-panel {
            flex: 1; background: var(--ui-bg); border-left: 4px solid #333;
            display: flex; flex-direction: column; padding: 10px; gap: 8px;
        }
        
        #status-display { 
            font-size: 16px; color: #888; text-align: center; 
            border: 1px solid #333; padding: 10px; background: #000; 
            margin-bottom: 5px; height: 30px; display: flex; align-items: center; justify-content: center;
        }
        
        #cam-grid {
            display: grid; grid-template-columns: 1fr 1fr; gap: 5px; flex-grow: 1; max-height: 50vh;
        }
        .cam-btn {
            background: #050505; color: #555; border: 1px solid #333;
            cursor: pointer; font-weight: bold; transition: 0.1s; font-size: 14px;
            display: flex; flex-direction: column; justify-content: center; align-items: center;
        }
        .cam-btn span { font-size: 10px; margin-top: 5px; color: #444; }
        .cam-btn:hover { color: white; background: #222; }
        .cam-btn.active { color: black; background: var(--text); border-color: white; }
        .cam-btn.active span { color: #003300; }

        .action-btn {
            padding: 15px; font-size: 16px; font-weight: bold; cursor: pointer; border: none; text-transform: uppercase;
        }
        #report-btn { background: #400; color: white; border: 1px solid red; }
        #report-btn:hover { background: red; color: black; }
        #clean-btn { background: #002200; color: #0f0; border: 1px solid #0f0; margin-top: 5px;}
        #clean-btn:hover { background: #0f0; color: black; }

        /* --- –ú–ï–ù–Æ –†–ï–ü–û–†–¢–ê --- */
        #report-overlay {
            position: absolute; inset: 0; background: rgba(0,0,0,0.95); z-index: 100;
            display: none; flex-direction: column; justify-content: center; align-items: center;
        }
        .rep-group { display: grid; grid-template-columns: 1fr 1fr; gap: 10px; width: 90%; }
        .rep-type {
            padding: 15px; background: #222; border: 1px solid #555;
            color: white; cursor: pointer; text-align: center; font-size: 14px; transition: 0.2s;
            display: flex; align-items: center; justify-content: center;
        }
        .rep-type:hover { background: white; color: black; border-color: white; }

        /* --- –ö–û–ú–ù–ê–¢–´ --- */
        .room-container {
            width: 100%; height: 100%; position: absolute; background: #111; display: none; overflow: hidden;
        }
        .room-container.visible { display: block; }
        
        .wall { 
            position: absolute; top: 0; left: 0; width: 100%; height: 75%; 
            background: #444; z-index: 0; 
            box-shadow: inset 0 0 150px rgba(0,0,0,1);
        }
        .floor { 
            position: absolute; bottom: 0; left: 0; width: 100%; height: 25%; 
            background: #222; z-index: 1; border-top: 2px solid #000; 
            background-image: repeating-linear-gradient(45deg, #222 25%, transparent 25%, transparent 75%, #222 75%, #222), repeating-linear-gradient(45deg, #222 25%, #1a1a1a 25%, #1a1a1a 75%, #222 75%, #222);
            background-position: 0 0, 10px 10px; background-size: 20px 20px;
        }

        .obj { 
            position: absolute; box-sizing: border-box; 
            transition: all 0.2s ease-out; z-index: 10;
            display: flex; align-items: center; justify-content: center;
            text-align: center; font-weight: bold; user-select: none;
        }

        /* –°—Ç–∏–ª–∏ –æ–±—ä–µ–∫—Ç–æ–≤ */
        .poster { background: #ddd; color: black; border: 2px solid #111; font-family: 'Impact', sans-serif; letter-spacing: 1px; }
        .window { background: #000510; border: 6px solid #222; overflow: hidden; }
        .window::before, .window::after { content:''; position:absolute; background:#222; }
        .window::before { top:0; left:50%; width:4px; height:100%; }
        .window::after { top:50%; left:0; width:100%; height:4px; }
        
        .furniture { background: #4e342e; border: 1px solid #222; box-shadow: 5px 5px 10px rgba(0,0,0,0.5); }
        
        /* –≠–º–æ–¥–∑–∏-–¥–µ–∫–æ—Ä */
        .deco-emoji { font-size: 20px; opacity: 0.7; z-index: 2; pointer-events: none; }
        
        /* –ê–Ω–æ–º–∞–ª—å–Ω—ã–µ –∫–ª–∞—Å—Å—ã */
        .ghost { 
            position: absolute; width: 60px; height: 140px; background: black; 
            border-radius: 50% 50% 0 0; filter: blur(6px); opacity: 0.95; z-index: 30; pointer-events: none;
        }
        .intruder-face {
            position: absolute; font-size: 80px; color: #444; opacity: 0.3; z-index: 5;
            filter: blur(2px); top: 10%; left: 20%;
        }

        /* –≠–∫—Ä–∞–Ω—ã */
        #fullscreen-msg {
            position: fixed; inset: 0; background: black; z-index: 200;
            display: flex; flex-direction: column; justify-content: center; align-items: center;
            font-size: 20px; text-align: center; padding: 40px; border: 10px solid #333;
        }
        .result-box {
            border: 1px solid #555; background: #111; padding: 20px; margin: 20px; max-width: 600px;
        }

        @keyframes blink { 50% { opacity: 0; } }
        .scary-text { color: red !important; font-family: 'Chiller', 'Courier', serif !important; transform: scale(1.1); }
        .scary-filter { filter: invert(1) contrast(1.5); }
        .blood-filter { box-shadow: inset 0 0 100px rgba(255,0,0,0.5); }

    </style>
</head>
<body>

    <!-- –≠–ö–†–ê–ù –°–¢–ê–†–¢–ê / –ì–ï–ô–ú–û–í–ï–†–ê -->
    <div id="fullscreen-msg">
        <h1 id="msg-title" style="color:var(--text); font-size: 40px;">–û–¢–î–ï–õ –ù–ê–ë–õ–Æ–î–ï–ù–ò–Ø</h1>
        <div class="result-box">
            <p id="msg-body" style="color:#ccc; line-height: 1.6;">
                –ó–ê–î–ê–ß–ê: –î–û–ô–¢–ò –î–û –£–†–û–í–ù–Ø 20.<br><br>
                <span style="color:var(--text)">–í–ù–ò–ú–ê–ù–ò–ï:</span> –ê–Ω–æ–º–∞–ª–∏–∏ –ø–æ—è–≤–ª—è—é—Ç—Å—è –ù–ï –°–†–ê–ó–£. <br>
                –í–∞–º –Ω—É–∂–Ω–æ –Ω–∞–±–ª—é–¥–∞—Ç—å 5-10 —Å–µ–∫—É–Ω–¥ –ø–æ—Å–ª–µ –Ω–∞—á–∞–ª–∞ —É—Ä–æ–≤–Ω—è.<br>
                –¢–µ–∫—Å—Ç, –ø—Ä–µ–¥–º–µ—Ç—ã, —ç–º–æ–¥–∑–∏ –º–æ–≥—É—Ç –∏–∑–º–µ–Ω–∏—Ç—å—Å—è –ø—Ä—è–º–æ —É –≤–∞—Å –Ω–∞ –≥–ª–∞–∑–∞—Ö.<br><br>
                –£—Ä–æ–≤–µ–Ω—å —Å–ª–æ–∂–Ω–æ—Å—Ç–∏: <b>–£–õ–¨–¢–†–ê</b>.
            </p>
        </div>
        <button onclick="initGame()" style="padding: 15px 40px; font-size: 24px; background: var(--text); border: none; cursor: pointer; font-weight: bold; margin-top: 20px;">–ù–ê–ß–ê–¢–¨ –°–ú–ï–ù–£</button>
    </div>

    <div id="monitor-frame">
        <div id="screen">
            <div id="scanlines"></div>
            <div id="static"></div>
            <div id="rec-dot"></div>
            <div id="cam-info">CAM 1</div>
            <div id="level-indicator">LVL 1</div>
            
            <div id="rooms-mount"></div>

            <!-- –ú–ï–ù–Æ –†–ï–ü–û–†–¢–ê -->
            <div id="report-overlay">
                <h2 style="color:var(--text); margin-bottom:10px;">–í–´–ë–ï–†–ò–¢–ï –¢–ò–ü –ê–ù–û–ú–ê–õ–ò–ò</h2>
                <div class="rep-group">
                    <div class="rep-type" onclick="checkAnswer('ghost')">üëª –ü–†–ò–ó–†–ê–ö / –¢–ï–ù–¨</div>
                    <div class="rep-type" onclick="checkAnswer('move')">üì¶ –ü–ï–†–ï–ú–ï–©–ï–ù–ò–ï</div>
                    <div class="rep-type" onclick="checkAnswer('extra')">‚ûï –õ–ò–®–ù–ò–ô –ü–†–ï–î–ú–ï–¢</div>
                    <div class="rep-type" onclick="checkAnswer('missing')">üí® –ò–°–ß–ï–ó–ù–û–í–ï–ù–ò–ï</div>
                    <div class="rep-type" onclick="checkAnswer('emoji')">üòà –≠–ú–û–î–ó–ò / –õ–ò–¶–û</div>
                    <div class="rep-type" onclick="checkAnswer('text')">üî§ –¢–ï–ö–°–¢ / –ù–ê–î–ü–ò–°–¨</div>
                    <div class="rep-type" onclick="checkAnswer('camera')">üìπ –°–ë–û–ô –ö–ê–ú–ï–†–´</div>
                    <div class="rep-type" onclick="checkAnswer('intruder')">üëÅÔ∏è –í –û–ö–ù–ï</div>
                </div>
                <div class="rep-type" style="border-color:red; color:red; margin-top:20px; width: 90%;" onclick="toggleReport()">–û–¢–ú–ï–ù–ê</div>
            </div>
        </div>
    </div>

    <div id="control-panel">
        <div id="status-display">–ó–ê–ì–†–£–ó–ö–ê...</div>
        
        <div id="cam-grid">
            <button class="cam-btn active" onclick="switchCam(0)">CAM 1<span>–°–ü–ê–õ–¨–ù–Ø</span></button>
            <button class="cam-btn" onclick="switchCam(1)">CAM 2<span>–ö–£–•–ù–Ø</span></button>
            <button class="cam-btn" onclick="switchCam(2)">CAM 3<span>–ó–ê–õ</span></button>
            <button class="cam-btn" onclick="switchCam(3)">CAM 4<span>–í–ê–ù–ù–ê–Ø</span></button>
            <button class="cam-btn" onclick="switchCam(4)">CAM 5<span>–ö–û–†–ò–î–û–†</span></button>
            <button class="cam-btn" onclick="switchCam(5)">CAM 6<span>–ü–û–î–í–ê–õ</span></button>
        </div>

        <button class="action-btn" id="clean-btn" onclick="checkAnswer('none')">‚úÖ –ê–ù–û–ú–ê–õ–ò–ô –ù–ï–¢</button>
        <button class="action-btn" id="report-btn" onclick="toggleReport()">‚ö†Ô∏è –†–ï–ü–û–†–¢</button>
    </div>

    <script>
        /* --- –ö–û–ù–§–ò–ì–£–†–ê–¶–ò–Ø --- */
        const MAX_LEVEL = 20;
        
        // –®–∞–±–ª–æ–Ω—ã –∫–æ–º–Ω–∞—Ç
        const ROOM_LAYOUTS = [
            {
                name: "–°–ü–ê–õ–¨–ù–Ø", wall: "#504040",
                items: [
                    { id: 'bed', type: 'furniture', bg:'#777', w:35, h:20, x:10, y:65, z:5 },
                    { id: 'win', type: 'window', w:20, h:30, x:40, y:10, z:1 },
                    { id: 'poster', type: 'poster', text:'DREAM', w:12, h:15, x:75, y:20, z:2 },
                    { id: 'toy', type: 'obj', text:'üß∏', w:5, h:5, x:15, y:60, z:6, style:'font-size:30px;' },
                    { id: 'clock', type: 'obj', text:'‚è∞', w:5, h:5, x:85, y:65, z:5, style:'font-size:25px;' }
                ]
            },
            {
                name: "–ö–£–•–ù–Ø", wall: "#606060",
                items: [
                    { id: 'fridge', type: 'furniture', bg:'#ddd', w:18, h:50, x:5, y:25, z:4 },
                    { id: 'table', type: 'furniture', bg:'#4e342e', w:30, h:20, x:35, y:60, z:5 },
                    { id: 'win2', type: 'window', w:25, h:20, x:40, y:10, z:1 },
                    { id: 'cup', type: 'obj', text:'‚òï', w:5, h:5, x:45, y:55, z:6, style:'font-size:20px;' },
                    { id: 'poster2', type: 'poster', text:'EAT', w:10, h:10, x:80, y:20, z:2 },
                    { id: 'plant', type: 'obj', text:'üåø', w:5, h:5, x:85, y:50, z:5, style:'font-size:40px;' }
                ]
            },
            {
                name: "–ó–ê–õ", wall: "#4a3b32",
                items: [
                    { id: 'sofa', type: 'furniture', bg:'#3e2723', w:45, h:15, x:25, y:65, z:5, style:'border-radius:10px 10px 0 0' },
                    { id: 'tv', type: 'obj', bg:'#111', w:25, h:18, x:70, y:45, z:4, style:'border:2px solid #444' },
                    { id: 'paint', type: 'poster', text:'HOME', w:15, h:20, x:10, y:15, z:1, style:'background:#543; color:#fff;' },
                    { id: 'cat', type: 'obj', text:'üêà', w:5, h:5, x:30, y:60, z:6, style:'font-size:30px;' },
                    { id: 'lamp', type: 'obj', text:'üõãÔ∏è', w:5, h:5, x:5, y:65, z:5, style:'font-size:40px;' }
                ]
            },
            {
                name: "–í–ê–ù–ù–ê–Ø", wall: "#37474f", 
                items: [
                    { id: 'mirror', type: 'obj', bg:'#aaddff', w:15, h:20, x:42, y:15, z:2, style:'border:3px solid silver' },
                    { id: 'bath', type: 'furniture', bg:'#eee', w:40, h:25, x:5, y:55, z:4 },
                    { id: 'duck', type: 'obj', text:'ü¶Ü', w:5, h:5, x:20, y:50, z:6, style:'font-size:20px;' },
                    { id: 'toilet', type: 'obj', text:'üöΩ', w:10, h:10, x:80, y:60, z:4, style:'font-size:50px;' },
                    { id: 'soap', type: 'obj', text:'üßº', w:5, h:5, x:45, y:40, z:5, style:'font-size:20px;' }
                ]
            },
            {
                name: "–ö–û–†–ò–î–û–†", wall: "#5d4037",
                items: [
                    { id: 'door', type: 'obj', bg:'#2e1c11', w:15, h:55, x:42, y:20, z:1, style:'border:2px solid black' },
                    { id: 'exit', type: 'poster', text:'EXIT', bg:'green', w:12, h:6, x:43, y:10, z:2, style:'color:white; font-size:12px;' },
                    { id: 'shoes', type: 'obj', text:'üëü', w:5, h:5, x:35, y:70, z:5, style:'font-size:25px;' },
                    { id: 'umbrella', type: 'obj', text:'üåÇ', w:5, h:5, x:60, y:65, z:5, style:'font-size:30px;' }
                ]
            },
            {
                name: "–ü–û–î–í–ê–õ", wall: "#1a1a1a",
                items: [
                    { id: 'shelf', type: 'furniture', bg:'#333', w:30, h:60, x:10, y:15, z:2 },
                    { id: 'box', type: 'obj', text:'üì¶', w:10, h:10, x:15, y:20, z:3, style:'font-size:40px;' },
                    { id: 'box2', type: 'obj', text:'üì¶', w:10, h:10, x:20, y:50, z:3, style:'font-size:40px;' },
                    { id: 'skull', type: 'obj', text:'üíÄ', w:5, h:5, x:80, y:70, z:4, style:'font-size:30px; opacity:0.5' },
                    { id: 'web', type: 'obj', text:'üï∏Ô∏è', w:10, h:10, x:85, y:5, z:5, style:'font-size:50px; opacity:0.6' }
                ]
            }
        ];

        /* --- STATE --- */
        let currentLevel = 1;
        let currentCam = 0;
        let anomalyData = { active: false, type: 'none', roomId: -1, description: '' };
        let anomalyTimer = null;
        let isGameOver = false;
        
        const AudioSys = {
            ctx: null,
            init: function() { if(!this.ctx) this.ctx = new (window.AudioContext || window.webkitAudioContext)(); },
            play: function(type) {
                if(!this.ctx) return;
                const o = this.ctx.createOscillator();
                const g = this.ctx.createGain();
                o.connect(g); g.connect(this.ctx.destination);
                
                if(type === 'static') {
                    // White noise buffer
                    const bSize = this.ctx.sampleRate * 0.2;
                    const b = this.ctx.createBuffer(1, bSize, this.ctx.sampleRate);
                    const d = b.getChannelData(0);
                    for(let i=0; i<bSize; i++) d[i] = Math.random() * 2 - 1;
                    const src = this.ctx.createBufferSource();
                    src.buffer = b;
                    src.connect(g); g.connect(this.ctx.destination);
                    g.gain.value = 0.05;
                    src.start();
                    return;
                }

                if(type === 'bad') {
                    o.type = 'sawtooth'; o.frequency.value = 80;
                    o.frequency.linearRampToValueAtTime(40, this.ctx.currentTime + 0.5);
                    g.gain.value = 0.3;
                    o.start(); o.stop(this.ctx.currentTime + 0.5);
                } else { // good
                    o.type = 'sine'; o.frequency.value = 600;
                    o.frequency.exponentialRampToValueAtTime(1000, this.ctx.currentTime + 0.1);
                    g.gain.value = 0.1;
                    o.start(); o.stop(this.ctx.currentTime + 0.15);
                }
            }
        };

        /* --- INITIALIZATION --- */
        function initGame() {
            document.getElementById('fullscreen-msg').style.display = 'none';
            isGameOver = false;
            AudioSys.init();
            
            // 1. –°–æ–∑–¥–∞–µ–º —Å—Ç—Ä—É–∫—Ç—É—Ä—É –∫–æ–º–Ω–∞—Ç –æ–¥–∏–Ω —Ä–∞–∑
            const mount = document.getElementById('rooms-mount');
            mount.innerHTML = '';
            
            ROOM_LAYOUTS.forEach((layout, idx) => {
                const r = document.createElement('div');
                r.className = 'room-container';
                r.id = `room-${idx}`;
                if(idx === 0) r.classList.add('visible');
                
                const w = document.createElement('div'); w.className = 'wall'; w.style.background = layout.wall;
                const f = document.createElement('div'); f.className = 'floor';
                r.appendChild(w); r.appendChild(f);

                // –û—Å–Ω–æ–≤–Ω—ã–µ –ø—Ä–µ–¥–º–µ—Ç—ã
                layout.items.forEach((item, itemIdx) => {
                    createObject(r, item, idx, itemIdx);
                });

                // –ú–£–°–û–† (–î–µ–∫–æ—Ä) - –ì–µ–Ω–µ—Ä–∏—Ä—É–µ–º —Å–ª—É—á–∞–π–Ω–æ –ø—Ä–∏ —Å—Ç–∞—Ä—Ç–µ –∏–≥—Ä—ã, —á—Ç–æ–±—ã –∏–≥—Ä–æ–∫ –∑–∞–ø–æ–º–∏–Ω–∞–ª —ç—Ç–∏ –º–µ–ª–æ—á–∏
                addRandomClutter(r, idx);

                mount.appendChild(r);
            });

            startLevel(1);
        }

        function createObject(parent, item, roomId, objIdPrefix) {
            const el = document.createElement('div');
            el.className = `obj ${item.type}`;
            el.id = `r${roomId}-${objIdPrefix}`; // –£–Ω–∏–∫–∞–ª—å–Ω—ã–π ID
            el.style.left = item.x + '%';
            el.style.top = item.y + '%';
            el.style.width = item.w + '%';
            el.style.height = item.h + '%';
            el.style.zIndex = item.z;
            if(item.bg) el.style.background = item.bg;
            if(item.text) el.innerText = item.text;
            if(item.style) el.style.cssText += item.style;
            
            // –°–æ—Ö—Ä–∞–Ω—è–µ–º –æ—Ä–∏–≥–∏–Ω–∞–ª –¥–ª—è —Å–±—Ä–æ—Å–∞
            el.dataset.origLeft = item.x + '%';
            el.dataset.origTop = item.y + '%';
            el.dataset.origText = item.text || '';
            el.dataset.origTransform = 'none';
            el.dataset.origOpacity = 1;
            
            parent.appendChild(el);
        }

        function addRandomClutter(roomDiv, roomId) {
            // –î–æ–±–∞–≤–ª—è–µ–º 2-3 —Å–ª—É—á–∞–π–Ω—ã—Ö —Å–∏–º–≤–æ–ª–∞ –Ω–∞ —Å—Ç–µ–Ω—ã
            const symbols = ['‚úñ', '‚óè', '‚ñ†', '‚ñ≤', '‚ô•', '‚òÖ', '‚ô¶', '‚ò∫'];
            for(let i=0; i<3; i++) {
                const s = document.createElement('div');
                s.className = 'obj deco-emoji';
                s.innerText = symbols[Math.floor(Math.random()*symbols.length)];
                s.style.left = (Math.random()*90) + '%';
                s.style.top = (Math.random()*50 + 10) + '%';
                s.style.color = 'rgba(255,255,255,0.2)';
                s.id = `r${roomId}-deco${i}`; // ID –¥–ª—è –∞–Ω–æ–º–∞–ª–∏–π
                roomDiv.appendChild(s);
            }
        }

        /* --- GAME LOGIC --- */
        function startLevel(lvl) {
            currentLevel = lvl;
            document.getElementById('level-indicator').innerText = `LVL ${lvl}/${MAX_LEVEL}`;
            document.getElementById('status-display').innerText = "–ü–ï–†–ï–ó–ê–ì–†–£–ó–ö–ê –°–ò–°–¢–ï–ú–´...";
            document.getElementById('status-display').style.color = "#888";
            
            resetRooms();
            if(anomalyTimer) clearTimeout(anomalyTimer);

            // –°—Ç–∞—Ç–∏–∫
            const st = document.getElementById('static');
            st.style.opacity = 1;
            AudioSys.play('static');
            
            setTimeout(() => {
                st.style.opacity = 0.08;
                document.getElementById('status-display').innerText = "–ù–ê–ë–õ–Æ–î–ï–ù–ò–ï...";
                document.getElementById('status-display').style.color = "#0f0";
                
                // –ü–ª–∞–Ω–∏—Ä—É–µ–º –∞–Ω–æ–º–∞–ª–∏—é
                scheduleAnomaly();
            }, 1000);
        }

        function resetRooms() {
            // –£–¥–∞–ª—è–µ–º –≤—Ä–µ–º–µ–Ω–Ω—ã–µ –æ–±—ä–µ–∫—Ç—ã
            document.querySelectorAll('.temp-anomaly').forEach(el => el.remove());
            // –°–±—Ä–æ—Å –≤—Å–µ—Ö —Å—Ç–∏–ª–µ–π
            document.querySelectorAll('.obj').forEach(el => {
                if(el.dataset.origLeft) el.style.left = el.dataset.origLeft;
                if(el.dataset.origTop) el.style.top = el.dataset.origTop;
                if(el.dataset.origText) el.innerText = el.dataset.origText;
                el.style.transform = 'none';
                el.style.opacity = el.className.includes('deco') ? 0.7 : 1;
                el.style.filter = 'none';
                el.style.color = '';
                el.classList.remove('scary-text');
                el.style.display = 'flex';
            });
            // –°–±—Ä–æ—Å –∫–æ–º–Ω–∞—Ç
            document.querySelectorAll('.room-container').forEach(r => {
                r.classList.remove('scary-filter');
                r.classList.remove('blood-filter');
            });
            
            anomalyData = { active: false, type: 'none', roomId: -1, description: '' };
        }

        function scheduleAnomaly() {
            // 60% —à–∞–Ω—Å –∞–Ω–æ–º–∞–ª–∏–∏
            if(Math.random() > 0.4) {
                // –ó–ê–î–ï–†–ñ–ö–ê! –ê–Ω–æ–º–∞–ª–∏—è –ø–æ—è–≤–ª—è–µ—Ç—Å—è —á–µ—Ä–µ–∑ 2-7 —Å–µ–∫—É–Ω–¥
                const delay = Math.random() * 5000 + 2000;
                anomalyTimer = setTimeout(triggerAnomaly, delay);
                // –ó–∞–ø–æ–º–∏–Ω–∞–µ–º, —á—Ç–æ –∞–Ω–æ–º–∞–ª–∏—è –∑–∞–ø–ª–∞–Ω–∏—Ä–æ–≤–∞–Ω–∞, –Ω–æ –µ—â–µ –Ω–µ –∞–∫—Ç–∏–≤–Ω–∞ (–¥–ª—è –ª–æ–≥–∏–∫–∏ –ø—Ä–æ–∏–≥—Ä—ã—à–∞)
                anomalyData.pending = true; 
            } else {
                anomalyData.type = 'none';
                anomalyData.active = false;
                anomalyData.pending = false;
                console.log("CLEAN LEVEL");
            }
        }

        function triggerAnomaly() {
            if(isGameOver) return;
            
            anomalyData.pending = false;
            anomalyData.active = true;
            
            const roomId = Math.floor(Math.random() * 6);
            const roomEl = document.getElementById(`room-${roomId}`);
            const allObjs = Array.from(roomEl.querySelectorAll('.obj')); // –í–∫–ª—é—á–∞—è –¥–µ–∫–æ—Ä
            const target = allObjs[Math.floor(Math.random() * allObjs.length)];
            const roomName = ROOM_LAYOUTS[roomId].name;

            anomalyData.roomId = roomId;

            // –¢–∏–ø—ã –∞–Ω–æ–º–∞–ª–∏–π
            const types = ['ghost', 'move', 'extra', 'missing', 'emoji', 'text', 'camera', 'intruder'];
            const type = types[Math.floor(Math.random() * types.length)];
            anomalyData.type = type;

            console.log(`ANOMALY SPAWNED: ${type} in ${roomName}`);

            switch(type) {
                case 'ghost': // –¢–µ–Ω—å
                    const g = document.createElement('div');
                    g.className = 'ghost temp-anomaly';
                    g.style.left = (Math.random()*80 + 10) + '%';
                    g.style.top = (Math.random()*20 + 30) + '%';
                    roomEl.appendChild(g);
                    anomalyData.description = `–í –∫–æ–º–Ω–∞—Ç–µ ${roomName} –ø–æ—è–≤–∏–ª–∞—Å—å —Ç–µ–º–Ω–∞—è —Ñ–∏–≥—É—Ä–∞ (–ü–†–ò–ó–†–ê–ö).`;
                    break;
                
                case 'move': // –°–¥–≤–∏–≥
                    if(target) {
                        target.style.transform = `rotate(${Math.random()*20 - 10}deg) translate(20px, 0)`;
                        anomalyData.description = `–í –∫–æ–º–Ω–∞—Ç–µ ${roomName} –ø—Ä–µ–¥–º–µ—Ç (${target.innerText || '–ú–µ–±–µ–ª—å'}) —Å–¥–≤–∏–Ω—É–ª—Å—è.`;
                    }
                    break;
                
                case 'extra': // –õ–∏—à–Ω–∏–π –ø—Ä–µ–¥–º–µ—Ç
                    const ex = document.createElement('div');
                    ex.className = 'obj temp-anomaly';
                    const extras = ['üî™', 'ü©∏', 'ü¶∂', 'üëÅÔ∏è', 'üé©'];
                    ex.innerText = extras[Math.floor(Math.random()*extras.length)];
                    ex.style.fontSize = '40px';
                    ex.style.left = (Math.random()*80 + 10) + '%';
                    ex.style.top = (Math.random()*50 + 40) + '%';
                    ex.style.zIndex = 20;
                    roomEl.appendChild(ex);
                    anomalyData.description = `–í –∫–æ–º–Ω–∞—Ç–µ ${roomName} –ø–æ—è–≤–∏–ª—Å—è –ª–∏—à–Ω–∏–π –ø—Ä–µ–¥–º–µ—Ç: ${ex.innerText}`;
                    break;

                case 'missing': // –ò—Å—á–µ–∑–Ω–æ–≤–µ–Ω–∏–µ
                    if(target) {
                        target.style.opacity = 0;
                        anomalyData.description = `–í –∫–æ–º–Ω–∞—Ç–µ ${roomName} –∏—Å—á–µ–∑ –æ–±—ä–µ–∫—Ç.`;
                    }
                    break;

                case 'emoji': // –ó–ª–æ–µ –ª–∏—Ü–æ (–∑–∞–º–µ–Ω–∞ —Å—É—â–µ—Å—Ç–≤—É—é—â–µ–≥–æ —ç–º–æ–¥–∑–∏ –∏–ª–∏ –ø—Ä–µ–¥–º–µ—Ç–∞ —Å —Ç–µ–∫—Å—Ç–æ–º)
                    const emojiObjs = allObjs.filter(o => o.innerText && o.innerText.match(/\p{Emoji}/u));
                    const emoTarg = emojiObjs.length > 0 ? emojiObjs[Math.floor(Math.random()*emojiObjs.length)] : target;
                    if(emoTarg) {
                        emoTarg.innerText = ['üòà', '‚ò†Ô∏è', 'üò°', 'üëπ'][Math.floor(Math.random()*4)];
                        emoTarg.classList.add('scary-text');
                        anomalyData.description = `–í –∫–æ–º–Ω–∞—Ç–µ ${roomName} —ç–º–æ–¥–∑–∏ –∏–∑–º–µ–Ω–∏–ª–æ—Å—å –Ω–∞ –∑–ª–æ–µ.`;
                    }
                    break;

                case 'text': // –¢–µ–∫—Å—Ç
                    const textObjs = allObjs.filter(o => o.classList.contains('poster'));
                    if(textObjs.length > 0) {
                        const t = textObjs[0];
                        t.innerText = ['DIE', 'RUN', 'HELL', 'WATCH'][Math.floor(Math.random()*4)];
                        t.classList.add('scary-text');
                        anomalyData.description = `–í –∫–æ–º–Ω–∞—Ç–µ ${roomName} –∏–∑–º–µ–Ω–∏–ª–∞—Å—å –Ω–∞–¥–ø–∏—Å—å –Ω–∞ –ø–æ—Å—Ç–µ—Ä–µ.`;
                    } else {
                        // –ï—Å–ª–∏ –ø–æ—Å—Ç–µ—Ä–∞ –Ω–µ—Ç, –ø—Ä–æ—Å—Ç–æ —Å–æ–∑–¥–∞–µ–º –Ω–∞–¥–ø–∏—Å—å –Ω–∞ —Å—Ç–µ–Ω–µ
                        const txt = document.createElement('div');
                        txt.className = 'obj temp-anomaly scary-text';
                        txt.innerText = "I SEE YOU";
                        txt.style.color = "red";
                        txt.style.fontSize = "20px";
                        txt.style.top = "10%"; txt.style.left = "30%";
                        roomEl.appendChild(txt);
                        anomalyData.description = `–í –∫–æ–º–Ω–∞—Ç–µ ${roomName} –ø–æ—è–≤–∏–ª–∞—Å—å –Ω–∞–¥–ø–∏—Å—å –Ω–∞ —Å—Ç–µ–Ω–µ.`;
                    }
                    break;

                case 'camera': // –§–∏–ª—å—Ç—Ä
                    if(Math.random() > 0.5) roomEl.classList.add('scary-filter');
                    else roomEl.classList.add('blood-filter');
                    anomalyData.description = `–í –∫–æ–º–Ω–∞—Ç–µ ${roomName} –ø—Ä–æ–∏–∑–æ—à–µ–ª —Å–±–æ–π –∫–∞–º–µ—Ä—ã (–∏—Å–∫–∞–∂–µ–Ω–∏–µ/–∫—Ä–æ–≤—å).`;
                    break;

                case 'intruder': // –õ–∏—Ü–æ –≤ –æ–∫–Ω–µ
                    const win = roomEl.querySelector('.window');
                    if(win) {
                        const face = document.createElement('div');
                        face.className = 'intruder-face temp-anomaly';
                        face.innerText = 'üòê';
                        win.appendChild(face);
                        anomalyData.description = `–í –∫–æ–º–Ω–∞—Ç–µ ${roomName} –≤ –æ–∫–Ω–µ –ø–æ—è–≤–∏–ª–æ—Å—å –ª–∏—Ü–æ.`;
                    } else {
                        // Fallback –Ω–∞ ghost
                        triggerAnomaly(); // Retry recursive (simple hack)
                        return;
                    }
                    break;
            }
        }

        /* --- UI HANDLERS --- */
        function switchCam(id) {
            document.querySelectorAll('.cam-btn').forEach(b => b.classList.remove('active'));
            document.querySelectorAll('.cam-btn')[id].classList.add('active');
            
            document.querySelectorAll('.room-container').forEach(r => r.classList.remove('visible'));
            document.getElementById(`room-${id}`).classList.add('visible');
            
            currentCam = id;
            document.getElementById('cam-info').innerText = `CAM ${id+1}`;
            AudioSys.play('static');
        }

        function toggleReport() {
            const el = document.getElementById('report-overlay');
            el.style.display = el.style.display === 'flex' ? 'none' : 'flex';
        }

        function checkAnswer(userChoice) {
            document.getElementById('report-overlay').style.display = 'none';
            
            // –ï—Å–ª–∏ –∏–≥—Ä–æ–∫ –Ω–∞–∂–∞–ª "–ß–∏—Å—Ç–æ"
            if(userChoice === 'none') {
                if(anomalyData.active || anomalyData.pending) {
                    // –û—à–∏–±–∫–∞: –ê–Ω–æ–º–∞–ª–∏—è –±—ã–ª–∞ –∏–ª–∏ –í–û–¢-–í–û–¢ –ø–æ—è–≤–∏—Ç—Å—è
                    gameOver(false, anomalyData.active ? anomalyData.description : "–í—ã –ø–æ—Ç–æ—Ä–æ–ø–∏–ª–∏—Å—å. –ê–Ω–æ–º–∞–ª–∏—è –ø–æ—è–≤–∏–ª–∞—Å—å —á–µ—Ä–µ–∑ —Å–µ–∫—É–Ω–¥—É –ø–æ—Å–ª–µ –≤–∞—à–µ–≥–æ –æ—Ç—á–µ—Ç–∞.");
                } else {
                    // –í–µ—Ä–Ω–æ
                    nextLevel();
                }
                return;
            }

            // –ï—Å–ª–∏ –∏–≥—Ä–æ–∫ –≤—ã–±—Ä–∞–ª —Ç–∏–ø –∞–Ω–æ–º–∞–ª–∏–∏
            // 1. –ê–Ω–æ–º–∞–ª–∏–∏ –≤–æ–æ–±—â–µ –Ω–µ—Ç?
            if(!anomalyData.active) {
                gameOver(false, "–í—ã –∑–∞—è–≤–∏–ª–∏ –æ–± –∞–Ω–æ–º–∞–ª–∏–∏, –Ω–æ –∫–æ–º–Ω–∞—Ç–∞ –±—ã–ª–∞ —á–∏—Å—Ç–∞. (–ü–∞—Ä–∞–Ω–æ–π—è?)");
                return;
            }

            // 2. –ù–µ —Ç–∞ –∫–æ–º–Ω–∞—Ç–∞?
            if(anomalyData.roomId !== currentCam) {
                gameOver(false, `–ê–Ω–æ–º–∞–ª–∏—è –¥–µ–π—Å—Ç–≤–∏—Ç–µ–ª—å–Ω–æ –±—ã–ª–∞, –Ω–æ –ù–ï –í –≠–¢–û–ô –∫–æ–º–Ω–∞—Ç–µ. <br>–ü—Ä–∞–≤–∏–ª—å–Ω—ã–π –æ—Ç–≤–µ—Ç: –ö–æ–º–Ω–∞—Ç–∞ ${ROOM_LAYOUTS[anomalyData.roomId].name}.`);
                return;
            }

            // 3. –ù–µ —Ç–æ—Ç —Ç–∏–ø?
            if(anomalyData.type !== userChoice) {
                gameOver(false, `–í—ã –∑–∞–º–µ—Ç–∏–ª–∏ –∞–Ω–æ–º–∞–ª–∏—é, –Ω–æ –ø–µ—Ä–µ–ø—É—Ç–∞–ª–∏ —Ç–∏–ø. <br>–í–∞—à –≤—ã–±–æ—Ä: ${userChoice}. <br>–†–µ–∞–ª—å–Ω–æ—Å—Ç—å: ${anomalyData.description}`);
                return;
            }

            // –í–°–Å –í–ï–†–ù–û
            nextLevel();
        }

        function nextLevel() {
            AudioSys.play('good');
            if(currentLevel >= MAX_LEVEL) {
                gameOver(true, "");
            } else {
                startLevel(currentLevel + 1);
            }
        }

        function gameOver(win, reason) {
            isGameOver = true;
            if(anomalyTimer) clearTimeout(anomalyTimer);
            
            const scr = document.getElementById('fullscreen-msg');
            const title = document.getElementById('msg-title');
            const body = document.getElementById('msg-body');
            
            scr.style.display = 'flex';
            
            if(win) {
                title.style.color = '#0f0';
                title.innerText = "–°–ú–ï–ù–ê –°–î–ê–ù–ê";
                body.innerHTML = "–í–´ –í–´–ñ–ò–õ–ò.<br>–í–°–ï –ê–ù–û–ú–ê–õ–ò–ò –£–°–¢–†–ê–ù–ï–ù–´.";
                AudioSys.play('good');
            } else {
                title.style.color = 'red';
                title.innerText = "–í–´ –ú–ï–†–¢–í–´";
                body.innerHTML = `<span style="color:white; font-size:24px;">–ü–†–ò–ß–ò–ù–ê –°–ú–ï–†–¢–ò:</span><br><br>${reason}<br><br><span style="color:#555">–£—Ä–æ–≤–µ–Ω—å: ${currentLevel}</span>`;
                AudioSys.play('bad');
            }
        }

        // START
        // –ñ–¥–µ–º –Ω–∞–∂–∞—Ç–∏—è –∫–Ω–æ–ø–∫–∏ –≤ UI
    </script>
</body>
</html>